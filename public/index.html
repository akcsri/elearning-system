<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂ e„É©„Éº„Éã„É≥„Ç∞„Ç∑„Çπ„ÉÜ„É† - DBÂÆåÂÖ®ÁÆ°ÁêÜÁâà</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header-left p {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            margin-top: 20px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #4ade80;
            transition: width 0.3s ease;
        }

        .content-area {
            padding: 40px;
        }

        .slide-container {
            min-height: 500px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 30px;
            position: relative;
            padding: 20px 0;
        }

        .slide-image {
            width: 100%;
            max-width: 1200px;
            height: auto;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .slide-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 1200px;
        }
        
        .slide-nav-button {
            flex-shrink: 0;
            min-width: 120px;
        }

        @media (max-width: 992px) {
            .slide-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .slide-nav-button {
                min-width: 100px;
            }
        }

        @media (max-width: 768px) {
            .content-area {
                padding: 20px;
            }
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quiz-question {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .question-number {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .question-text {
            font-size: 20px;
            font-weight: 600;
            color: #1e3c72;
            line-height: 1.8;
        }

        .option {
            margin-bottom: 15px;
            padding: 20px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .option.selected {
            background: #e0e7ff;
            border-color: #667eea;
        }

        .option.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .explanation-box {
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .explanation-title {
            color: #059669;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 12px;
        }

        .quiz-result {
            text-align: center;
            padding: 40px;
        }

        .score-display {
            font-size: 72px;
            font-weight: 700;
            color: #667eea;
            margin: 30px 0;
        }

        .result-message {
            font-size: 24px;
            margin: 20px 0;
        }

        .result-message.pass {
            color: #10b981;
        }

        .result-message.fail {
            color: #ef4444;
        }

        .certificate-container {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border: 8px double #d4af37;
            border-radius: 16px;
            padding: 50px;
            margin: 30px auto;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .certificate-title {
            font-size: 36px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .certificate-body {
            background: white;
            padding: 40px;
            border-radius: 8px;
            color: #333;
        }

        .certificate-name {
            font-size: 28px;
            font-weight: 700;
            color: #1e3c72;
            margin: 30px 0;
            padding: 15px;
            border-top: 2px solid #d4af37;
            border-bottom: 2px solid #d4af37;
        }

        .start-screen {
            text-align: center;
            padding: 60px 40px;
        }

        .start-screen h2 {
            font-size: 36px;
            color: #1e3c72;
        }

        .course-info {
            background: #f9fafb;
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            text-align: left;
        }

        .course-info h3 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .course-info ul {
            list-style: none;
            padding: 0;
        }

        .course-info li {
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            background: #f9fafb;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 20px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            color: #667eea;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            font-size: 24px;
            color: #1e3c72;
        }

        .course-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .course-structure {
            margin-top: 20px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .structure-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
        }

        .section-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
        }

        .badge-training {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-test {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-explanation {
            background: #d1fae5;
            color: #065f46;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #6b7280;
        }

        .modal-close:hover {
            color: #1e3c72;
        }

        .login-screen {
            text-align: center;
            padding: 80px 40px;
        }

        .login-box {
            background: white;
            border-radius: 16px;
            padding: 50px;
            max-width: 500px;
            margin: 0 auto;
        }

        .login-box h2 {
            font-size: 32px;
            color: #1e3c72;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
        }

        .processing-indicator {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .processing-indicator.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-result {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #f0f4ff;
            border-radius: 12px;
        }

        .analysis-result.active {
            display: block;
        }

        .analysis-section {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .question-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .question-item {
            padding: 10px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }

        .resume-banner {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .resume-banner-content {
            flex: 1;
            min-width: 250px;
        }

        .resume-banner-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
        }

        .resume-banner-text {
            color: #1e40af;
            font-size: 14px;
        }

        .resume-banner-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .nav-tab {
                padding: 15px 20px;
                font-size: 14px;
            }
            
            table {
                font-size: 14px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        .error-message {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .success-message {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .db-status {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ÂÆüÈöõ„ÅÆPowerPoint„Åã„ÇâÊäΩÂá∫„Åï„Çå„ÅüÂÖ®10Âïè„ÅÆ„Éá„Éº„Çø
        const EXTRACTED_QUESTIONS = [
            {
                id: 1,
                number: 1,
                question: "PE„Éï„Ç°„É≥„Éâ„ÅÆÊäïË≥áÊãÖÂΩìËÄÖA„Åï„Çì„ÅØ„ÄÅÊäïË≥áÂÖàBÁ§æ„ÅÆÂèñÁ∑†ÂΩπ„Å®„Åó„Å¶„ÄÅ‰ªñÁ§æ„Å®„ÅÆÂêà‰Ωµ„ÇíÊ§úË®é‰∏≠„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁü•„Çä„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆÊÉÖÂ†±„ÅØ„Åæ„Å†ÂÖ¨Ë°®„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇA„Åï„Çì„ÅåÂêåÂÉöC„Åï„Çì„Å´„ÄåBÁ§æÊ†™„ÇíË≤∑„ÅÜ„Å®„ÅÑ„ÅÑ„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„Çà„Äç„Å®‰ºù„Åà„ÇãË°åÁÇ∫„ÅØ„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å´Ë©ï‰æ°„Åï„Çå„Åæ„Åô„Åã„ÄÇ",
                options: [
                    "Âêà‰Ωµ„ÅåÊ≠£ÂºèÊ±∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„ÅßÈÅïÊ≥ï„Åß„ÅØ„Å™„ÅÑ",
                    "Âêà‰Ωµ„ÅÆ‰∫ãÂÆü„Åù„ÅÆ„ÇÇ„ÅÆ„Çí‰ºù„Åà„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„ÅßÈÅïÊ≥ï„Åß„ÅØ„Å™„ÅÑ",
                    "ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Å®„Åó„Å¶ÈÅïÊ≥ï„Åß„ÅÇ„Çã",
                    "C„Åï„Çì„ÅåÂÆüÈöõ„Å´ÂèñÂºï„Çí„Åó„Å™„Åë„Çå„Å∞ÈÅïÊ≥ï„Åß„ÅØ„Å™„ÅÑ"
                ],
                correctAnswer: 2,
                explanation: "ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅØ„ÄÅÈáçË¶Å‰∫ãÂÆü„ÇíÁü•„Çä„Å™„Åå„Çâ‰ªñËÄÖ„Å´ÂèñÂºï„ÇíÊé®Â•®„Åô„ÇãË°åÁÇ∫„Åù„ÅÆ„ÇÇ„ÅÆ„ÅåË¶èÂà∂ÂØæË±°„Åß„Åô„ÄÇÁõ∏ÊâãÊñπ„ÅåÂÆüÈöõ„Å´ÂèñÂºï„Åó„Åü„Åã„Å©„ÅÜ„Åã„ÄÅÈáçË¶Å‰∫ãÂÆü„Åù„ÅÆ„ÇÇ„ÅÆ„Çí‰ºù„Åà„Åü„Åã„Å©„ÅÜ„Åã„ÅØÈñ¢‰øÇ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂêà‰Ωµ„ÅÆÊ§úË®é„ÅØ„ÄÅ„Åü„Å®„ÅàÊ≠£ÂºèÊ±∫ÂÆöÂâç„Åß„ÇÇÈáçË¶Å‰∫ãÂÆü„Å´Ë©≤ÂΩì„Åó„Åà„Åæ„Åô„ÄÇÊé®Â•®Ë°åÁÇ∫Ëá™‰Ωì„ÅåÈÅïÊ≥ï„Åß„ÅÇ„Çä„ÄÅÁõ∏ÊâãÊñπ„ÅåÂèñÂºï„Åó„Å™„Åè„Å¶„ÇÇÊàêÁ´ã„Åó„Åæ„Åô„ÄÇ"
            },
            {
                id: 2,
                number: 2,
                question: "„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å´„Åä„Åë„Çã„ÄåÊÉÖÂ†±‰ºùÈÅî„ÉªÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Äç„ÅÆË¶èÂà∂ÂØæË±°ËÄÖ„Å®„Åó„Å¶„ÄÅÊ≠£„Åó„Åè„Å™„ÅÑ„ÇÇ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„Åã„ÄÇ",
                options: [
                    "‰∏äÂ†¥‰ºöÁ§æ„ÅÆÂæìÊ•≠Âì°",
                    "Â•ëÁ¥Ñ„Å´Âü∫„Å•„ÅçÈáçË¶Å‰∫ãÂÆü„ÇíÁü•„Å£„ÅüËÄÖ",
                    "‰ºöÁ§æÈñ¢‰øÇËÄÖ„Åã„ÇâÊÉÖÂ†±„ÇíÂèó„ÅëÂèñ„Å£„ÅüÁ¨¨‰∏ÄÊ¨°ÊÉÖÂ†±ÂèóÈ†òËÄÖ",
                    "‰ºöÁ§æÈñ¢‰øÇËÄÖ„ÇíÈÄÄËÅ∑„Åó„Å¶6„É∂ÊúàÁµåÈÅé„Åó„ÅüËÄÖ"
                ],
                correctAnswer: 2,
                explanation: "ÊÉÖÂ†±‰ºùÈÅî„ÉªÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅÆË¶èÂà∂ÂØæË±°„ÅØ„Äå‰ºöÁ§æÈñ¢‰øÇËÄÖÁ≠â„Äç„Åß„Åô„ÄÇÁ¨¨‰∏ÄÊ¨°ÊÉÖÂ†±ÂèóÈ†òËÄÖ„ÅØËá™„Çâ„ÅåÂèñÂºï„Åô„Çã„Åì„Å®„ÅØÁ¶ÅÊ≠¢„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ‰ªñËÄÖ„Å∏„ÅÆÊÉÖÂ†±‰ºùÈÅî„ÉªÂèñÂºïÊé®Â•®„ÅØÈáëÂïÜÊ≥ï166Êù°Á¨¨3È†Ö„ÅÆÁõ¥Êé•„ÅÆË¶èÂà∂ÂØæË±°„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Å™„Åä„ÄÅÈÄÄËÅ∑ËÄÖ„ÅØÈÄÄËÅ∑Âæå1Âπ¥Èñì(6„É∂Êúà„Åß„ÅØ„Å™„ÅÑ)Ë¶èÂà∂ÂØæË±°„Å®„Å™„Çä„Åæ„Åô„ÄÇ"
            },
            {
                id: 3,
                number: 3,
                question: "PE„Éï„Ç°„É≥„Éâ„ÅÆÊãÖÂΩìËÄÖ„ÅåÊäïË≥áÂÖà‰ºÅÊ•≠„ÅÆÊú™ÂÖ¨Ë°®„ÅÆÊ±∫ÁÆóÊÉÖÂ†±„ÇíÁü•„Å£„ÅüÂ†¥Âêà„ÄÅ‰ª•‰∏ã„ÅÆ„Å©„ÅÆË°åÁÇ∫„ÅåË®±„Åï„Çå„Åæ„Åô„Åã„ÄÇ",
                options: [
                    "ÂÆ∂Êóè„Å´„Äå„Åì„ÅÆ‰ºöÁ§æ„ÅÆÊ†™„ÇíË≤∑„Å£„Å¶„Åä„ÅÑ„ÅüÊñπ„Åå„ÅÑ„ÅÑ„Äç„Å®Âãß„ÇÅ„Çã",
                    "ËÅ∑Âãô‰∏äÂøÖË¶Å„Å™ÁØÑÂõ≤„Åß„ÄÅ„Éï„Ç°„É≥„ÉâÂÜÖ„ÅÆÊãÖÂΩìËÄÖ„Å´ÊÉÖÂ†±ÂÖ±Êúâ„Åô„Çã",
                    "Âèã‰∫∫„Å´Ê±∫ÁÆóÊï∞ÂÄ§„Çí‰ºù„Åà„Å¶„ÄÅÂèñÂºï„ÇíÊé®Â•®„Åô„Çã",
                    "SNS„Åß„ÄåÊäïË≥áÂÖà„ÅÆÊ•≠Á∏æ„ÅåÂ•ΩË™ø„Äç„Å®ÊäïÁ®ø„Åô„Çã"
                ],
                correctAnswer: 1,
                explanation: "ËÅ∑Âãô‰∏ä„ÅÆÊ≠£ÂΩì„Å™ÁêÜÁî±„Å´Âü∫„Å•„ÅèÊÉÖÂ†±ÂÖ±Êúâ„ÅØ„ÄÅNeed-to-KnowÂéüÂâá„Å´Âæì„ÅÑ„ÄÅÁü•„ÇãÂøÖË¶Å„Åå„ÅÇ„ÇãËÄÖ„Å´ÈôêÂÆö„Åô„Çå„Å∞Ë®±ÂÆπ„Åï„Çå„Åæ„Åô„ÄÇÂÆ∂Êóè„ÉªÂèã‰∫∫„Å∏„ÅÆÊé®Â•®„ÇÑSNS„Åß„ÅÆÁô∫‰ø°„ÅØËÅ∑Âãô‰∏ä„ÅÆÊ≠£ÂΩìÊÄß„Åå„Å™„Åè„ÄÅÊòé„Çâ„Åã„Å™ÈÅïÂèç„Åß„Åô„ÄÇÂΩ¢Âºè„Åß„ÅØ„Å™„ÅèÂÆüË≥™ÁöÑ„Å™ÊÑèÂõ≥„ÇÑÁõÆÁöÑ„ÅåÈáçË¶ñ„Åï„Çå„Åæ„Åô„ÄÇ"
            },
            {
                id: 4,
                number: 4,
                question: "ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅÆË¶èÂà∂„Å´Èñ¢„Åô„ÇãË™¨Êòé„Å®„Åó„Å¶„ÄÅÊ≠£„Åó„ÅÑ„ÇÇ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„Åã„ÄÇ",
                options: [
                    "Áõ∏ÊâãÊñπ„ÅåÂÆüÈöõ„Å´ÂèñÂºï„Çí„Åó„Å¶Âà©Áõä„ÇíÂæó„ÅüÂ†¥Âêà„Å´„ÅÆ„ÅøÈÅïÂèç„Å®„Å™„Çã",
                    "ÈáçË¶Å‰∫ãÂÆü„Åù„ÅÆ„ÇÇ„ÅÆ„Çí‰ºù„Åà„Å™„Åë„Çå„Å∞„ÄÅÂèñÂºï„ÇíÊé®Â•®„Åó„Å¶„ÇÇÈÅïÂèç„Å®„Å™„Çâ„Å™„ÅÑ",
                    "Êé®Â•®Ë°åÁÇ∫„Åù„ÅÆ„ÇÇ„ÅÆ„ÅåÈÅïÂèç„Åß„ÅÇ„Çä„ÄÅÁõ∏ÊâãÊñπ„ÅåÂèñÂºï„Çí„Åó„Å™„Åè„Å¶„ÇÇÊàêÁ´ã„Åô„Çã",
                    "Êé®Â•®„Åô„ÇãÈöõ„Å´ÊÇ™ÊÑè„Åå„Å™„Åë„Çå„Å∞ÈÅïÂèç„Å®„Å™„Çâ„Å™„ÅÑ"
                ],
                correctAnswer: 2,
                explanation: "ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅØ„ÄÅË°åÁÇ∫„Åù„ÅÆ„ÇÇ„ÅÆ„ÅåÈÅïÂèç„Å®„Å™„ÇãË¶èÂà∂„Åß„Åô„ÄÇÁõ∏ÊâãÊñπ„ÅåÂÆüÈöõ„Å´ÂèñÂºï„Åó„Åü„Åã„Å©„ÅÜ„Åã„ÄÅÂà©Áõä„ÇíÂæó„Åü„Åã„Å©„ÅÜ„Åã„ÄÅÈáçË¶Å‰∫ãÂÆü„ÇíÊòéÁ§∫ÁöÑ„Å´‰ºù„Åà„Åü„Åã„Å©„ÅÜ„Åã„ÄÅÊÇ™ÊÑè„ÅÆÊúâÁÑ°„ÅØÈñ¢‰øÇ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊé®Â•®Ë°åÁÇ∫Ëá™‰Ωì„ÅåÁΩ∞„Åõ„Çâ„Çå„Åæ„Åô„ÄÇ"
            },
            {
                id: 5,
                number: 5,
                question: "‰ª•‰∏ã„ÅÆ„ÅÜ„Å°„ÄÅÈáëÂïÜÊ≥ï166Êù°„ÅßË¶èÂÆö„Åï„Çå„Çã„ÄåÈáçË¶Å‰∫ãÂÆü„Äç„Å´Ë©≤ÂΩì„Åó„Å™„ÅÑ„ÇÇ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„Åã„ÄÇ",
                options: [
                    "Ê†™ÂºèÂàÜÂâ≤„ÅÆÊ±∫ÂÆö",
                    "Á¨¨‰∏âËÄÖÂâ≤ÂΩìÂ¢óË≥á„ÅÆÊ±∫ÂÆö",
                    "Á§æÂì°È£üÂ†Ç„ÅÆ„É°„Éã„É•„ÉºÂ§âÊõ¥",
                    "Ê•≠Á∏æ‰∫àÊÉ≥„ÅÆÂ§ßÂπÖ„Å™‰øÆÊ≠£"
                ],
                correctAnswer: 2,
                explanation: "ÈáçË¶Å‰∫ãÂÆü„Å®„ÅØ„ÄÅÊäïË≥áËÄÖ„ÅÆÊäïË≥áÂà§Êñ≠„Å´Ëëó„Åó„ÅÑÂΩ±Èüø„ÇíÂèä„Åº„Åô„Åπ„Åç‰∫ãÂÆü„Åß„Åô„ÄÇÊ†™ÂºèÂàÜÂâ≤„ÄÅÁ¨¨‰∏âËÄÖÂâ≤ÂΩìÂ¢óË≥á„ÄÅÊ•≠Á∏æ‰∫àÊÉ≥„ÅÆ‰øÆÊ≠£„ÅØÂÖ∏ÂûãÁöÑ„Å™ÈáçË¶Å‰∫ãÂÆü„Åß„Åô„Åå„ÄÅÁ§æÂì°È£üÂ†Ç„ÅÆ„É°„Éã„É•„ÉºÂ§âÊõ¥„ÅØ‰ºöÁ§æ„ÅÆË≤°ÂãôÁä∂ÊÖã„ÇÑÁµåÂñ∂ÊàêÁ∏æ„Å´ÈáçË¶Å„Å™ÂΩ±Èüø„Çí‰∏é„Åà„Åö„ÄÅÊäïË≥áÂà§Êñ≠„Å´ÂΩ±Èüø„ÇíÂèä„Åº„Åó„Åæ„Åõ„Çì„ÄÇ"
            },
            {
                id: 6,
                number: 6,
                question: "PE„Éï„Ç°„É≥„Éâ„ÅÆÊäïË≥áÊãÖÂΩìËÄÖ„Åå„ÄÅÊäïË≥áÂÖà‰ºÅÊ•≠„ÅÆÊú™ÂÖ¨Ë°®„ÅÆM&AÊÉÖÂ†±„ÇíÁü•„Å£„ÅüÂ†¥Âêà„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å™ÂØæÂøú„ÅåÊúÄ„ÇÇÈÅ©Âàá„Åß„Åô„Åã„ÄÇ",
                options: [
                    "‰ªñ„ÅÆ„Éï„Ç°„É≥„Éâ„É°„É≥„Éê„Éº„Å´„ÇÇÂ∫É„ÅèÂÖ±Êúâ„Åó„Å¶„ÄÅÊÑèË¶ã„ÇíÊ±Ç„ÇÅ„Çã",
                    "ÊÉÖÂ†±ÁÆ°ÁêÜË¶èÁ®ã„Å´Âæì„ÅÑ„ÄÅÁü•„ÇãÂøÖË¶Å„ÅÆ„ÅÇ„ÇãËÄÖ„Å´ÈôêÂÆö„Åó„Å¶ÂÖ±Êúâ„Åô„Çã",
                    "Ë¶™„Åó„ÅÑÂèñÂºïÂÖà„Å´ÊäïË≥áÊ©ü‰ºö„Å®„Åó„Å¶Á¥π‰ªã„Åô„Çã",
                    "„Åæ„Å†Ê±∫ÂÆö„Åß„ÅØ„Å™„ÅÑ„ÅÆ„Åß„ÄÅÁ§æÂÜÖÂ§ñ„Å´Ëá™Áî±„Å´Ë©±„Åó„Å¶„ÇÇÂïèÈ°å„Å™„ÅÑ"
                ],
                correctAnswer: 1,
                explanation: "Êú™ÂÖ¨Ë°®„ÅÆM&AÊÉÖÂ†±„ÅØÂÖ∏ÂûãÁöÑ„Å™ÈáçË¶Å‰∫ãÂÆü„Åß„Åô„ÄÇÊÉÖÂ†±ÁÆ°ÁêÜË¶èÁ®ã„Å´Âæì„ÅÑ„ÄÅËÅ∑Âãô‰∏äÁü•„ÇãÂøÖË¶Å„Åå„ÅÇ„ÇãËÄÖ„Å´ÈôêÂÆö„Åó„Å¶ÂÖ±Êúâ„Åô„Åπ„Åç„Åß„Åô„ÄÇÂ∫É„ÅèÂÖ±Êúâ„Åô„Çã„Åì„Å®„ÅØÊÉÖÂ†±ÊºèÊ¥©„É™„Çπ„ÇØ„ÇíÈ´ò„ÇÅ„ÄÅÂèñÂºïÂÖà„Å∏„ÅÆÁ¥π‰ªã„ÅØËÅ∑Âãô‰∏ä„ÅÆÊ≠£ÂΩìÊÄß„Åå„Å™„ÅÑÈÅïÂèç„Åß„Åô„ÄÇ„ÄåÊ±∫ÂÆö„Åß„ÅØ„Å™„ÅÑ„Äç„Åì„Å®„ÅØÂÖçË≤¨ÁêÜÁî±„Å´„Å™„Çä„Åæ„Åõ„Çì„ÄÇ"
            },
            {
                id: 7,
                number: 7,
                question: "ÊÉÖÂ†±‰ºùÈÅî„ÉªÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅÆÈÅïÂèç„Å´ÂØæ„Åô„ÇãÁΩ∞Ââá„Å®„Åó„Å¶„ÄÅÊ≠£„Åó„Åè„Å™„ÅÑ„ÇÇ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„Åã„ÄÇ",
                options: [
                    "ÂÄã‰∫∫„Å´ÂØæ„Åó„Å¶5Âπ¥‰ª•‰∏ã„ÅÆÊá≤ÂΩπ",
                    "ÂÄã‰∫∫„Å´ÂØæ„Åó„Å¶500‰∏áÂÜÜ‰ª•‰∏ã„ÅÆÁΩ∞Èáë",
                    "Ê≥ï‰∫∫„Å´ÂØæ„Åó„Å¶5ÂÑÑÂÜÜ‰ª•‰∏ã„ÅÆÁΩ∞Èáë",
                    "ÂÄã‰∫∫„Å´ÂØæ„Åó„Å¶ÂøÖ„ÅöÊá≤ÂΩπÂàë„ÅåÁßë„Åï„Çå„Çã"
                ],
                correctAnswer: 3,
                explanation: "ÈÅïÂèç„Å´ÂØæ„Åô„ÇãÂàë‰∫ãÁΩ∞„ÅØ„Äå5Âπ¥‰ª•‰∏ã„ÅÆÊá≤ÂΩπ„ÇÇ„Åó„Åè„ÅØ500‰∏áÂÜÜ‰ª•‰∏ã„ÅÆÁΩ∞Èáë„Äç„Åæ„Åü„ÅØ„Åù„ÅÆ‰ΩµÁßë„Åß„Åô„ÄÇ„ÄåÂøÖ„ÅöÊá≤ÂΩπÂàë„Äç„Åß„ÅØ„Å™„Åè„ÄÅÁΩ∞ÈáëÂàë„ÅÆ„Åø„ÅÆÂ†¥Âêà„ÇÑ‰ΩµÁßë„ÇÇ„ÅÇ„Çä„Åà„Åæ„Åô„ÄÇÂàëÁΩ∞„ÅÆÈÅ∏Êäû„ÅØË£ÅÂà§ÊâÄ„Åå‰∫ãÊ°à„ÅÆÊÇ™Ë≥™ÊÄß„ÇíËÄÉÊÖÆ„Åó„Å¶Âà§Êñ≠„Åó„Åæ„Åô„ÄÇÊ≥ï‰∫∫„Å´„ÅØ5ÂÑÑÂÜÜ‰ª•‰∏ã„ÅÆÁΩ∞Èáë„ÅåÁßë„Åï„Çå„Åæ„Åô„ÄÇ"
            },
            {
                id: 8,
                number: 8,
                question: "Ê¨°„ÅÆ„ÅÜ„Å°„ÄÅ„ÄåÂèñÂºïÊé®Â•®„Äç„Å´Ë©≤ÂΩì„Åô„ÇãÂèØËÉΩÊÄß„ÅåÊúÄ„ÇÇ‰Ωé„ÅÑ„ÇÇ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„Åã„ÄÇ",
                options: [
                    "„Äå‰ªä„ÅåAÁ§æÊ†™„ÅÆË≤∑„ÅÑÊôÇ„Å†„Çà„Äç„Å®Âèã‰∫∫„Å´‰ºù„Åà„Çã",
                    "„ÄåAÁ§æ„ÅØÊ•≠Á∏æ„ÅåËâØ„Åï„Åù„ÅÜ„Å†„Åã„ÇâÊ≥®ÁõÆ„Åó„Å¶„ÅÑ„Çã„Äç„Å®Ë®Ä„ÅÜ",
                    "„ÄåAÁ§æ„ÅÆÊ†™‰æ°„Åå‰∏ä„Åå„Çä„Åù„ÅÜ„Å†„Åã„Çâ„ÄÅË≤∑„Å£„Å¶„Åø„Åü„Çâ„Äç„Å®Âãß„ÇÅ„Çã",
                    "ÂºÅË≠∑Â£´„Å´Ê≥ïÁöÑ„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíÊ±Ç„ÇÅ„Çã„Åü„ÇÅ„ÄÅÊäïË≥áÂÖà„ÅÆÁä∂Ê≥Å„ÇíË™¨Êòé„Åô„Çã"
                ],
                correctAnswer: 3,
                explanation: "ÂºÅË≠∑Â£´„Å∏„ÅÆÁõ∏Ë´á„ÅÆ„Åü„ÇÅ„ÅÆÊÉÖÂ†±Êèê‰æõ„ÅØ„ÄÅËÅ∑Âãô‰∏ä„ÅÆÊ≠£ÂΩì„Å™ÁêÜÁî±„Åå„ÅÇ„Çä„ÄÅÂèñÂºïÊé®Â•®ÁõÆÁöÑ„Åå„Å™„ÅÑ„Åü„ÇÅÈÅïÊ≥ï„Å™Ë°åÁÇ∫„Å´„ÅØË©≤ÂΩì„Åó„Åæ„Åõ„Çì„ÄÇ„ÄåË≤∑„ÅÑÊôÇ„Äç„ÄåË≤∑„Å£„Å¶„Åø„Åü„Çâ„Äç„ÅØÊòéÁ§∫ÁöÑ„Å™Êé®Â•®„Åß„Åô„ÄÇ„ÄåÊ•≠Á∏æ„ÅåËâØ„Åï„Åù„ÅÜ„Äç„ÇÇÊäïË≥áÂà§Êñ≠„Å´ÂΩ±Èüø„Çí‰∏é„Åà„ÇãÊÑèÂõ≥„ÅåË™ç„ÇÅ„Çâ„Çå„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ"
            },
            {
                id: 9,
                number: 9,
                question: "‰ºöÁ§æÈñ¢‰øÇËÄÖ„ÅåÈÄÄËÅ∑„Åó„ÅüÂ†¥Âêà„ÄÅÊÉÖÂ†±‰ºùÈÅî„ÉªÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅÆË¶èÂà∂„ÅØ„ÄÅÈÄÄËÅ∑Âæå„Å©„ÅÆ„Åè„Çâ„ÅÑ„ÅÆÊúüÈñìÈÅ©Áî®„Åï„Çå„Åæ„Åô„Åã„ÄÇ",
                options: [
                    "ÈÄÄËÅ∑„Å®ÂêåÊôÇ„Å´Ë¶èÂà∂ÂØæË±°Â§ñ„Å®„Å™„Çã",
                    "ÈÄÄËÅ∑Âæå6„É∂ÊúàÈñì",
                    "ÈÄÄËÅ∑Âæå1Âπ¥Èñì",
                    "ÈÄÄËÅ∑Âæå2Âπ¥Èñì"
                ],
                correctAnswer: 2,
                explanation: "ÈáëÂïÜÊ≥ï166Êù°Á¨¨1È†Ö„Åß„ÅØ„ÄÅ‰ºöÁ§æÈñ¢‰øÇËÄÖ„Åß„ÅÇ„Å£„ÅüËÄÖ(ÈÄÄËÅ∑ËÄÖ)„Å´„Å§„ÅÑ„Å¶„ÄÅÈÄÄËÅ∑Âæå1Âπ¥Èñì„ÅØ‰ºöÁ§æÈñ¢‰øÇËÄÖ„Å®„Åó„Å¶Ë¶èÂà∂ÂØæË±°„Å®„Å™„Çã„Åì„Å®„ÅåÊòéË®ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÂú®ËÅ∑‰∏≠„Å´Áü•„Å£„ÅüÈáçË¶Å‰∫ãÂÆü„ÇíÈÄÄËÅ∑Âæå„Åô„Åê„Å´Âà©Áî®„Åô„Çã„Åì„Å®„ÇíÈò≤Ê≠¢„Åô„ÇãË¶èÂÆö„Åß„Åô„ÄÇ"
            },
            {
                id: 10,
                number: 10,
                question: "PE„Éï„Ç°„É≥„Éâ„ÅÆÊãÖÂΩìËÄÖ„Åå„ÄÅÊäïË≥áÂÖà‰ºÅÊ•≠„Å´„Å§„ÅÑ„Å¶ÈáçË¶Å‰∫ãÂÆü„ÇíÁü•„Å£„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã‰∏çÊòé„Å™Â†¥Âêà„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å´ÂØæÂøú„Åô„Åπ„Åç„Åß„Åô„Åã„ÄÇ",
                options: [
                    "Ëá™ÂàÜ„ÅÆÂà§Êñ≠„ÅßÂïèÈ°å„Å™„ÅÑ„Å®ÊÄù„Åà„Å∞„ÄÅÂèñÂºï„ÇÑÊé®Â•®„Çí„Åó„Å¶„ÇÇ„Çà„ÅÑ",
                    "Â∞ëÈ°ç„ÅÆÂèñÂºï„Åß„ÅÇ„Çå„Å∞ÂïèÈ°å„Å™„ÅÑ",
                    "„Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„ÇπÈÉ®ÈñÄ„Å´Áõ∏Ë´á„Åó„Å¶Á¢∫Ë™ç„Åô„Çã",
                    "ÈáçË¶Å‰∫ãÂÆü„ÇíÁü•„Çâ„Å™„ÅÑ„Å®ÂÆ£Ë®Ä„Åô„Çå„Å∞ÂïèÈ°å„Å™„ÅÑ"
                ],
                correctAnswer: 2,
                explanation: "ÈáçË¶Å‰∫ãÂÆü„ÇíÁü•„Å£„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã‰∏çÊòé„Å™Â†¥Âêà„ÄÅÊúÄ„ÇÇÈÅ©Âàá„Å™ÂØæÂøú„ÅØ„Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„ÇπÈÉ®ÈñÄ„Å´Áõ∏Ë´á„Åô„Çã„Åì„Å®„Åß„Åô„ÄÇÈáçË¶Å‰∫ãÂÆü„ÅÆË©≤ÂΩìÊÄß„ÅØÊ≥ïÁöÑ„Å™Âà§Êñ≠„ÇíË¶Å„Åó„Åæ„Åô„ÄÇËá™Â∑±Âà§Êñ≠„ÅØÂç±Èô∫„Åß„ÄÅÈáëÈ°ç„ÅÆÂ§öÂØ°„ÇÇÈñ¢‰øÇ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„ÄåÁñë„Çè„Åó„Åç„ÅØÁõ∏Ë´á„Äç„ÅåÂéüÂâá„Åß„Åô„ÄÇ"
            }
        ];

        // „Çπ„É©„Ç§„ÉâÁîªÂÉè„Éá„Éº„Çø
        function getSlideTitle(slideNum) {
            const titles = [
                '„ÅØ„Åò„ÇÅ„Å´',
                '„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å®„ÅØ',
                'ÈáëËûçÂïÜÂìÅÂèñÂºïÊ≥ï„ÅÆÂü∫Êú¨ÊßãÈÄ†',
                'Á¨¨1Á´† ÂèñÂºïË¶èÂà∂„ÅÆÊ¶ÇË¶Å',
                'Á¨¨2Á´† ‰ºöÁ§æÈñ¢‰øÇËÄÖ„ÅÆÁØÑÂõ≤',
                'Á¨¨3Á´† ÈáçË¶Å‰∫ãÂÆü„ÅÆÂÆöÁæ©',
                'Á¨¨4Á´† ÊÉÖÂ†±‰ºùÈÅî„ÉªÂèñÂºïÊé®Â•®Ë°åÁÇ∫',
                'Á¨¨5Á´† ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„ÅÆÊÑèÁæ©',
                'Á¨¨6Á´† PE„Éï„Ç°„É≥„Éâ„Å´„Åä„Åë„ÇãÊ≥®ÊÑèÁÇπ',
                'Á¨¨7Á´† ÂÖ∑‰ΩìÁöÑ‰∫ã‰æã',
                'Á¨¨8Á´† ÈÅïÂèç‰∫ã‰æã',
                'Á¨¨9Á´† ÁΩ∞Ââá„Å´„Å§„ÅÑ„Å¶',
                'Á¨¨10Á´† „Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„Çπ‰ΩìÂà∂',
                'Á¨¨11Á´† ÊÉÖÂ†±ÁÆ°ÁêÜ„ÅÆÈáçË¶ÅÊÄß',
                'Á¨¨12Á´† ÈÄÄËÅ∑ÂæåË¶èÂà∂',
                'Á¨¨13Á´† Áõ∏Ë´áÁ™ìÂè£',
                'Á¨¨14Á´† 5„Å§„ÅÆÈâÑÂâá',
                'Á¨¨15Á´† „Åæ„Å®„ÇÅ',
                '„ÉÜ„Çπ„Éà„Å´ÈÄ≤„Åø„Åæ„Åó„Çá„ÅÜ'
            ];
            return titles[slideNum - 1] || 'Á†î‰øÆÂÜÖÂÆπ';
        }
        
        const slideImages = Array.from({length: 19}, (_, i) => {
            const svg = `<svg width="1200" height="675" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 675">
                <rect width="1200" height="675" fill="#f0f4ff"/>
                <rect x="50" y="40" width="1100" height="120" fill="#667eea" rx="12"/>
                <text x="600" y="110" font-family="Arial, sans-serif" font-size="42" fill="white" text-anchor="middle" font-weight="bold">„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂Á†î‰øÆ</text>
                <rect x="50" y="200" width="1100" height="420" fill="white" stroke="#e5e7eb" stroke-width="3" rx="12"/>
                <text x="600" y="300" font-family="Arial, sans-serif" font-size="64" fill="#1e3c72" text-anchor="middle" font-weight="bold">„Çπ„É©„Ç§„Éâ ${i + 1} / 19</text>
                <text x="600" y="380" font-family="Arial, sans-serif" font-size="28" fill="#6b7280" text-anchor="middle">${getSlideTitle(i + 1)}</text>
                <text x="600" y="480" font-family="Arial, sans-serif" font-size="20" fill="#9ca3af" text-anchor="middle">‚Äª „Åì„Çå„ÅØ„Éá„É¢Áî®„ÅÆ„Çπ„É©„Ç§„Éâ„Åß„Åô</text>
                <text x="600" y="520" font-family="Arial, sans-serif" font-size="18" fill="#9ca3af" text-anchor="middle">ÂÆüÈöõ„ÅÆPowerPoint„Çí„Ç§„É≥„Éù„Éº„Éà„Åô„Çã„Åì„Å®„Åß</text>
                <text x="600" y="555" font-family="Arial, sans-serif" font-size="18" fill="#9ca3af" text-anchor="middle">Êú¨Áâ©„ÅÆ„Çπ„É©„Ç§„ÉâÁîªÂÉè„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</text>
            </svg>`;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        });

        // „Éá„Éº„Çø„Éô„Éº„ÇπÁÆ°ÁêÜ - ÂÆåÂÖ®DB‰æùÂ≠òÁâà
        const Database = {
            API_BASE: window.location.origin,
            
            // ÂàùÊúü„É¶„Éº„Ç∂„Éº„Éá„Éº„ÇøÂÆöÁæ©
            getInitialUsers() {
                return [
                    {
                        id: 1,
                        username: 'admin',
                        password: 'admin123',
                        name: 'ÈáëÂ≠ê ÊòéÂΩ¶',
                        email: 'akihiko.kaneko@csri-japan.com',
                        role: 'admin',
                        department: '„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Ç∫ÈÉ®'
                    },
                    {
                        id: 2,
                        username: 'user1',
                        password: 'user1123',
                        name: 'ÂâçÁî∞ Êãì',
                        email: 'taku.maeda@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 3,
                        username: 'user2',
                        password: 'user2123',
                        name: 'Ëó§Ê£Æ Áæ©Êòé',
                        email: 'yoshiaki.fujimori@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 4,
                        username: 'user3',
                        password: 'user3123',
                        name: 'Â†ÄÂÜÖ ÈßøÂ§™ÈÉé',
                        email: 'shuntaro.horiuchi@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 5,
                        username: 'user4',
                        password: 'user4123',
                        name: 'È´ôÊ©ã ÈÇ¶ÊØîÂëÇ',
                        email: 'kunihiro.takahashi@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 6,
                        username: 'user5',
                        password: 'user5123',
                        name: 'Èáë‰∫ï ÈßøÂ§™Êúó',
                        email: 'shuntaro.kanai@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 7,
                        username: 'user6',
                        password: 'user6123',
                        name: 'Â°©Ë∞∑ Ëºù',
                        email: 'hikaru.shioya@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 8,
                        username: 'user7',
                        password: 'user7123',
                        name: 'Â∂ãÔ®ë Ê±üÁæé',
                        email: 'emi.shimazaki@csri-japan.com',
                        role: 'user',
                        department: '„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®'
                    },
                    {
                        id: 9,
                        username: 'user8',
                        password: 'user8123',
                        name: 'ÂêâÁî∞ ÊÑõÁæé',
                        email: 'manami.yoshida@csri-japan.com',
                        role: 'user',
                        department: '„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Ç∫ÈÉ®'
                    },
                    {
                        id: 10,
                        username: 'user9',
                        password: 'user9123',
                        name: 'ÈáëÂ≠ê ÊòéÂΩ¶',
                        email: 'akihiko.kaneko@csri-japan.com',
                        role: 'user',
                        department: '„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Ç∫ÈÉ®'
                    },
                    {
                        id: 11,
                        username: 'user10',
                        password: 'user10123',
                        name: 'Â∑ùÁ´Ø ÁúüËá≥',
                        email: 'shinji.kawahata@csri-japan.com',
                        role: 'user',
                        department: '„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Ç∫ÈÉ®'
                    }
                ];
            },
            
            // DBÂàùÊúüÂåñ - ÂàùÂõûËµ∑ÂãïÊôÇ„Å´ÂàùÊúü„Éá„Éº„Çø„ÇíËá™ÂãïÊäïÂÖ•
            async init() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/data`);
                    
                    if (!response.ok || response.status === 404) {
                        console.log('üîß DB„ÅåÁ©∫„Åß„Åô„ÄÇÂàùÊúü„Éá„Éº„Çø„ÇíÊäïÂÖ•„Åó„Åæ„Åô...');
                        const initialData = {
                            users: this.getInitialUsers(),
                            courses: [],
                            learningRecords: [],
                            lastUpdated: new Date().toISOString()
                        };
                        
                        const saveResponse = await fetch(`${this.API_BASE}/api/data`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(initialData)
                        });
                        
                        if (saveResponse.ok) {
                            console.log('‚úÖ ÂàùÊúü„Éá„Éº„Çø„ÇíDB„Å´ÊäïÂÖ•„Åó„Åæ„Åó„Åü');
                            AppData.users = this.getInitialUsers();
                            AppData.courses = [];
                            AppData.learningRecords = [];
                            return true;
                        }
                    } else {
                        // DB„Åã„Çâ„Éá„Éº„Çø„Çí„É≠„Éº„Éâ
                        return await this.load();
                    }
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå DBÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                    // „Ç®„É©„ÉºÊôÇ„ÅØ„É≠„Éº„Ç´„É´„ÅßÂàùÊúü„Éá„Éº„Çø„Çí‰ΩøÁî®
                    AppData.users = this.getInitialUsers();
                    AppData.courses = [];
                    AppData.learningRecords = [];
                    return false;
                }
            },
            
            async save() {
                try {
                    const dataToSave = {
                        users: AppData.users,
                        courses: AppData.courses,
                        learningRecords: AppData.learningRecords,
                        lastUpdated: new Date().toISOString()
                    };
                    const response = await fetch(`${this.API_BASE}/api/data`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dataToSave)
                    });
                    const result = await response.json();
                    if (result.success) {
                        console.log('üíæ [' + new Date().toLocaleTimeString() + '] „Éá„Éº„Çø„ÇíDB„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('‚ùå „Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    return false;
                }
            },
            
            async load() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/data`);
                    if (response.ok) {
                        const data = await response.json();
                        
                        AppData.users = data.users || this.getInitialUsers();
                        AppData.courses = data.courses || [];
                        AppData.learningRecords = data.learningRecords || [];
                        
                        console.log('‚úÖ DB„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü', {
                            users: AppData.users.length,
                            courses: AppData.courses.length,
                            records: AppData.learningRecords.length,
                            lastUpdated: data.lastUpdated || '‰∏çÊòé'
                        });
                        return true;
                    } else {
                        console.log('‚ö†Ô∏è DB„Å´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                        AppData.users = this.getInitialUsers();
                        AppData.courses = [];
                        AppData.learningRecords = [];
                        return false;
                    }
                } catch (error) {
                    console.error('‚ùå „Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    AppData.users = this.getInitialUsers();
                    AppData.courses = [];
                    AppData.learningRecords = [];
                    return false;
                }
            },
            
            async saveProgress(userId) {
                try {
                    const progress = {
                        ...AppData.learningState,
                        userId: userId,
                        courseId: AppData.currentCourse ? AppData.currentCourse.id : null,
                        lastUpdated: new Date().toISOString()
                    };
                    const response = await fetch(`${this.API_BASE}/api/progress/${userId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(progress)
                    });
                    const result = await response.json();
                    if (result.success) {
                        console.log('üíæ ÈÄ≤Ë°åÁä∂Ê≥Å„Çí‰øùÂ≠ò (User: ' + userId + ')');
                        AppData.progressData[userId] = progress;
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('‚ùå ÈÄ≤Ë°åÁä∂Ê≥Å‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    return false;
                }
            },
            
            async loadProgress(userId) {
                try {
                    const response = await fetch(`${this.API_BASE}/api/progress/${userId}`);
                    if (response.ok) {
                        const progress = await response.json();
                        const hoursSince = (Date.now() - new Date(progress.lastUpdated)) / (1000 * 60 * 60);
                        if (hoursSince > 24) {
                            await this.clearProgress(userId);
                            return null;
                        }
                        console.log('‚úÖ ÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÂæ©ÂÖÉ (User: ' + userId + ')');
                        return progress;
                    }
                    return null;
                } catch (error) {
                    return null;
                }
            },
            
            async clearProgress(userId) {
                try {
                    const response = await fetch(`${this.API_BASE}/api/progress/${userId}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    console.log('üóëÔ∏è ÈÄ≤Ë°åÁä∂Ê≥Å„Çí„ÇØ„É™„Ç¢ (User: ' + userId + ')');
                    return result.success || false;
                } catch (error) {
                    return false;
                }
            },
            
            async clear() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/data`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    return result.success || false;
                } catch (error) {
                    return false;
                }
            },
            
            async export() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/export`);
                    if (response.ok) {
                        return await response.text();
                    }
                    return null;
                } catch (error) {
                    return null;
                }
            },
            
            async import(jsonString) {
                try {
                    const data = JSON.parse(jsonString);
                    const response = await fetch(`${this.API_BASE}/api/import`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    if (result.success) {
                        await this.load();
                        return true;
                    }
                    return false;
                } catch (error) {
                    return false;
                }
            },

            async loadAllProgress() {
                try {
                    const progressData = {};
                    const progressPromises = AppData.users.map(async (user) => {
                        try {
                            const progress = await this.loadProgress(user.id);
                            if (progress) {
                                progressData[user.id] = progress;
                            }
                        } catch (error) {
                            console.error(`ÈÄ≤Êçó„É≠„Éº„Éâ„Ç®„É©„Éº (User ${user.id}):`, error);
                        }
                    });
                    await Promise.all(progressPromises);
                    AppData.progressData = progressData;
                    console.log('‚úÖ ÂÖ®„É¶„Éº„Ç∂„Éº„ÅÆÈÄ≤Êçó„Éá„Éº„Çø„Çí„É≠„Éº„Éâ', {
                        loaded: Object.keys(progressData).length,
                        total: AppData.users.length
                    });
                    return true;
                } catch (error) {
                    console.error('‚ùå ÈÄ≤Êçó‰∏ÄÊã¨„É≠„Éº„Éâ„Ç®„É©„Éº:', error);
                    return false;
                }
            }
        };

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Éá„Éº„Çø - ÂÖ®„Å¶DB„Åã„ÇâË™≠„ÅøËæº„ÇÄ
        const AppData = {
            currentUser: null,
            currentCourse: null,
            analysisResult: null,
            savedProgress: null,
            progressData: {},
            users: [],  // DBÂàùÊúüÂåñÊôÇ„Å´Ë®≠ÂÆö
            courses: [],  // DBÂàùÊúüÂåñÊôÇ„Å´Ë®≠ÂÆö
            learningRecords: [],  // DBÂàùÊúüÂåñÊôÇ„Å´Ë®≠ÂÆö
            learningState: {
                screen: 'start',
                slideIndex: 0,
                questionIndex: 0,
                userName: '',
                userDept: '',
                answers: {},
                showExplanations: {}
            }
        };

        // PowerPointËß£Êûê„Ç®„É≥„Ç∏„É≥
        const PPTXAnalyzer = {
            extractedImages: [],
            
            async analyzePPTX(file) {
                try {
                    const zip = await JSZip.loadAsync(file);
                    const imageFiles = [];
                    
                    const files = Object.keys(zip.files)
                        .filter(name => name.startsWith('ppt/media/') && 
                                      (name.endsWith('.png') || name.endsWith('.jpg') || 
                                       name.endsWith('.jpeg') || name.endsWith('.emf')))
                        .sort();
                    
                    for (const filename of files) {
                        try {
                            const file = zip.files[filename];
                            const blob = await file.async('blob');
                            const base64 = await this.blobToBase64(blob);
                            
                            let mimeType = 'image/png';
                            if (filename.endsWith('.jpg') || filename.endsWith('.jpeg')) {
                                mimeType = 'image/jpeg';
                            }
                            
                            imageFiles.push({
                                name: filename,
                                data: base64,
                                mimeType: mimeType
                            });
                        } catch (err) {
                            console.error('ÁîªÂÉèË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', filename, err);
                        }
                    }
                    
                    this.extractedImages = imageFiles;
                    
                    return {
                        fileName: file.name,
                        totalSlides: Math.max(imageFiles.length, 19),
                        extractedImageCount: imageFiles.length,
                        sections: {
                            training: {
                                name: 'Á†î‰øÆ„ÉÜ„Ç≠„Çπ„Éà',
                                slideCount: Math.max(imageFiles.length, 19),
                                topics: []
                            },
                            test: {
                                name: 'Á¢∫Ë™ç„ÉÜ„Çπ„Éà',
                                slideCount: 10,
                                questions: EXTRACTED_QUESTIONS
                            },
                            explanation: {
                                name: 'Ëß£Ë™¨',
                                slideCount: 0,
                                topics: []
                            }
                        },
                        metadata: {
                            title: '„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å´„Åä„Åë„ÇãÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Å´Èñ¢„Åô„ÇãÁ†î‰øÆ',
                            subtitle: 'PE„Éï„Ç°„É≥„ÉâÂæìÊ•≠Âì°Âêë„Åë',
                            date: new Date().toISOString().split('T')[0]
                        }
                    };
                } catch (error) {
                    console.error('PPTXËß£Êûê„Ç®„É©„Éº:', error);
                    return null;
                }
            },
            
            blobToBase64(blob) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            }
        };

        // „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥
        const App = {
            currentView: 'login',
            currentTab: 'dashboard',

            async init() {
                console.log('üöÄ „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Ëµ∑Âãï - DBÂÆåÂÖ®ÁÆ°ÁêÜÁâà');
                
                // DBÂàùÊúüÂåñÔºàÂàùÂõûËµ∑ÂãïÊôÇ„ÅØËá™ÂãïÁöÑ„Å´ÂàùÊúü„Éá„Éº„Çø„ÇíÊäïÂÖ•Ôºâ
                await Database.init();
                
                // ÂÖ®„É¶„Éº„Ç∂„Éº„ÅÆÈÄ≤Êçó„Éá„Éº„Çø„Çí„É≠„Éº„Éâ
                await Database.loadAllProgress();
                
                // ÂÆöÊúüÁöÑ„Å´DB„Å´Ëá™Âãï‰øùÂ≠òÔºà2Áßí„Åî„Å®Ôºâ
                setInterval(() => {
                    if (AppData.users.length > 0 || AppData.courses.length > 0 || AppData.learningRecords.length > 0) {
                        Database.save();
                    }
                }, 2000);
                
                // ÈÄ≤Ë°åÁä∂Ê≥Å„ÅÆÂÆöÊúü‰øùÂ≠òÔºà30Áßí„Åî„Å®Ôºâ
                setInterval(() => {
                    if (AppData.currentUser && 
                        (AppData.learningState.screen === 'training' || 
                        AppData.learningState.screen === 'quiz')) {
                        Database.saveProgress(AppData.currentUser.id);
                    }
                }, 30000);
                
                this.render();
            },

            render() {
                const appDiv = document.getElementById('app');
                
                if (!AppData.currentUser) {
                    appDiv.innerHTML = this.renderLogin();
                    this.attachLoginListeners();
                } else if (this.currentView === 'learning') {
                    appDiv.innerHTML = this.renderLearning();
                    this.attachLearningListeners();
                } else if (AppData.currentUser.role === 'admin') {
                    appDiv.innerHTML = this.renderAdmin();
                    this.attachAdminListeners();
                } else {
                    appDiv.innerHTML = this.renderLearning();
                    this.attachLearningListeners();
                }
            },

            renderLogin() {
                return `
                    <div class="app-container">
                        <div class="header">
                            <div class="header-left">
                                <h1>üìö e„É©„Éº„Éã„É≥„Ç∞„Ç∑„Çπ„ÉÜ„É†</h1>
                                <p>DBÂÆåÂÖ®ÁÆ°ÁêÜÁâà</p>
                            </div>
                        </div>
                        <div class="login-screen">
                            <div class="login-box">
                                <h2>„É≠„Ç∞„Ç§„É≥</h2>
                                <div class="db-status">
                                    ‚úÖ „Ç∑„Çπ„ÉÜ„É†„ÅØ„Éá„Éº„Çø„Éô„Éº„Çπ„Å®Êé•Á∂ö„Åï„Çå„Å¶„ÅÑ„Åæ„Åô<br>
                                    ÂÖ®„Å¶„ÅÆ„Éá„Éº„Çø„ÅØDB„Å´Ë®òÈå≤„ÉªÂèÇÁÖß„Åï„Çå„Åæ„Åô
                                </div>
                                <div class="form-group">
                                    <label>„É¶„Éº„Ç∂„ÉºÂêç</label>
                                    <input type="text" id="username" placeholder="‰æã: admin „Åæ„Åü„ÅØ user1">
                                </div>
                                <div class="form-group">
                                    <label>„Éë„Çπ„ÉØ„Éº„Éâ</label>
                                    <input type="password" id="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                                </div>
                                <button class="btn btn-primary" style="width: 100%;" onclick="App.login()">
                                    „É≠„Ç∞„Ç§„É≥
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderAdmin() {
                return `
                    <div class="app-container">
                        <div class="header">
                            <div class="header-left">
                                <h1>üìö e„É©„Éº„Éã„É≥„Ç∞ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
                                <p>ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ - DBÂÆåÂÖ®ÁÆ°ÁêÜÁâà</p>
                            </div>
                            <div class="header-right" style="text-align: right;">
                                <div style="color: white; margin-bottom: 10px;">
                                    üë§ ${AppData.currentUser.name} (ÁÆ°ÁêÜËÄÖ)
                                </div>
                                <button class="btn btn-logout btn-small" onclick="App.logout()">
                                    „É≠„Ç∞„Ç¢„Ç¶„Éà
                                </button>
                            </div>
                        </div>
                        
                        <div class="nav-tabs">
                            <div class="nav-tab ${App.currentTab === 'dashboard' ? 'active' : ''}" 
                                 onclick="App.switchTab('dashboard')">
                                üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                            </div>
                            <div class="nav-tab ${App.currentTab === 'courses' ? 'active' : ''}" 
                                 onclick="App.switchTab('courses')">
                                üìñ „Ç≥„Éº„ÇπÁÆ°ÁêÜ
                            </div>
                            <div class="nav-tab ${App.currentTab === 'learners' ? 'active' : ''}" 
                                 onclick="App.switchTab('learners')">
                                üë• ÂèóË¨õËÄÖÁÆ°ÁêÜ
                            </div>
                            <div class="nav-tab ${App.currentTab === 'import' ? 'active' : ''}" 
                                 onclick="App.switchTab('import')">
                                üì§ PPTX„Ç§„É≥„Éù„Éº„Éà
                            </div>
                            <div class="nav-tab ${App.currentTab === 'preview-learning' ? 'active' : ''}" 
                                 onclick="App.switchToLearning()">
                                üéì ÂèóË¨õÁîªÈù¢„Å∏
                            </div>
                        </div>
                        
                        <div class="content-area">
                            ${this.renderAdminTab()}
                        </div>
                    </div>
                `;
            },

            renderAdminTab() {
                switch (App.currentTab) {
                    case 'dashboard':
                        return this.renderDashboard();
                    case 'courses':
                        return this.renderCourses();
                    case 'learners':
                        return this.renderLearners();
                    case 'import':
                        return this.renderImport();
                    default:
                        return '';
                }
            },

            renderDashboard() {
                const totalUsers = AppData.users.filter(u => u.role === 'user').length;
                const totalCourses = AppData.courses.length;
                const totalRecords = AppData.learningRecords.length;
                const completedRecords = AppData.learningRecords.filter(r => r.status === 'completed' && r.passed).length;
                
                return `
                    <div class="db-status">
                        üíæ „Éá„Éº„Çø„Éô„Éº„ÇπÊé•Á∂öÁä∂ÊÖã: <strong>Ê≠£Â∏∏</strong><br>
                        üìä ÂÖ®„Éá„Éº„Çø„ÅØDB„Å´Ë®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºà„É¶„Éº„Ç∂„Éº: ${AppData.users.length}‰ª∂„ÄÅ„Ç≥„Éº„Çπ: ${totalCourses}‰ª∂„ÄÅÂ≠¶ÁøíË®òÈå≤: ${totalRecords}‰ª∂Ôºâ<br>
                        üîÑ Ëá™Âãï‰øùÂ≠ò: ÊúâÂäπÔºà2Áßí„Åî„Å®Ôºâ
                    </div>
                    
                    <div class="section-header">
                        <h2>üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px;">
                            <div style="font-size: 48px; font-weight: 700;">${totalUsers}</div>
                            <div style="font-size: 18px; margin-top: 10px;">ÁôªÈå≤ÂèóË¨õËÄÖÊï∞</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 30px; border-radius: 12px;">
                            <div style="font-size: 48px; font-weight: 700;">${totalCourses}</div>
                            <div style="font-size: 18px; margin-top: 10px;">„Ç≥„Éº„ÇπÊï∞</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; border-radius: 12px;">
                            <div style="font-size: 48px; font-weight: 700;">${totalRecords}</div>
                            <div style="font-size: 18px; margin-top: 10px;">Á∑èÂèóË¨õÊï∞</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 30px; border-radius: 12px;">
                            <div style="font-size: 48px; font-weight: 700;">${completedRecords}</div>
                            <div style="font-size: 18px; margin-top: 10px;">‰øÆ‰∫ÜËÄÖÊï∞</div>
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 30px; border: 2px solid #e5e7eb; margin-bottom: 20px;">
                        <h3 style="color: #1e3c72; margin-bottom: 20px;">üìå „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±</h3>
                        <p style="color: #6b7280; line-height: 2;">
                            ‚úÖ „Éá„Éº„Çø„Éô„Éº„ÇπÂÆåÂÖ®ÁÆ°ÁêÜÁâà„ÅåÊúâÂäπ„Åß„Åô<br>
                            ‚úÖ ÂÖ®„Éá„Éº„Çø„ÅåDB„Å´Ë®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô<br>
                            ‚úÖ Ëá™Âãï‰øùÂ≠òÊ©üËÉΩ„ÅåÂãï‰Ωú‰∏≠<br>
                            ‚úÖ ÈÄ≤Ë°åÁä∂Ê≥Å„ÅÆÂæ©ÂÖÉÊ©üËÉΩ„ÅåÊúâÂäπ<br>
                            ‚úÖ „É¶„Éº„Ç∂„ÉºËøΩÂä†ÊôÇ„Å´Âç≥Â∫ß„Å´DB‰øùÂ≠ò
                        </p>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 30px; border: 2px solid #e5e7eb;">
                        <h3 style="color: #1e3c72; margin-bottom: 20px;">üíæ „Éá„Éº„Çø„Éô„Éº„ÇπÁÆ°ÁêÜ</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <button class="btn btn-success" onclick="App.saveDatabase()">
                                üíæ ÊâãÂãï‰øùÂ≠ò
                            </button>
                            <button class="btn btn-primary" onclick="App.exportDatabase()">
                                üì§ „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                            </button>
                            <button class="btn btn-warning" onclick="App.importDatabase()">
                                üì• „Éá„Éº„Çø„Ç§„É≥„Éù„Éº„Éà
                            </button>
                            <button class="btn btn-danger" onclick="App.clearDatabase()">
                                üóëÔ∏è „Éá„Éº„Çø„ÇØ„É™„Ç¢
                            </button>
                        </div>
                    </div>
                `;
            },

            renderLearners() {
                const learners = AppData.users.filter(u => u.role === 'user');
                
                return `
                    <div class="section-header">
                        <h2>üë• ÂèóË¨õËÄÖÁÆ°ÁêÜ</h2>
                        <button class="btn btn-primary" onclick="App.showAddLearnerModal()">
                            ‚ûï ÂèóË¨õËÄÖ„ÇíËøΩÂä†
                        </button>
                    </div>

                    ${learners.length === 0 ? `
                        <div style="text-align: center; padding: 60px;">
                            <div style="font-size: 64px; margin-bottom: 20px;">üë•</div>
                            <h3>ÂèóË¨õËÄÖ„Åå„Åæ„Å†„ÅÑ„Åæ„Åõ„Çì</h3>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="App.showAddLearnerModal()">
                                ÊúÄÂàù„ÅÆÂèóË¨õËÄÖ„ÇíËøΩÂä†
                            </button>
                        </div>
                    ` : `
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                                <thead style="background: #f9fafb;">
                                    <tr>
                                        <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">Ê∞èÂêç</th>
                                        <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">ÈÉ®ÁΩ≤</th>
                                        <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">„É°„Éº„É´</th>
                                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #e5e7eb;">ÂèóË¨õÁä∂Ê≥Å</th>
                                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #e5e7eb;">„ÉÜ„Çπ„ÉàÁµêÊûú</th>
                                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #e5e7eb;">‰øÆ‰∫ÜË®º</th>
                                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #e5e7eb;">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${learners.map(learner => {
                                        const records = AppData.learningRecords.filter(r => r.userId === learner.id);
                                        const latestRecord = records.length > 0 ? records[records.length - 1] : null;
                                        const progress = AppData.progressData[learner.id];
                                        
                                        let statusBadge = '<span style="background: #e5e7eb; color: #6b7280; padding: 4px 12px; border-radius: 12px; font-size: 12px;">Êú™ÈñãÂßã</span>';
                                        let testResult = '-';
                                        let certificate = '-';
                                        
                                        if (progress && !latestRecord) {
                                            statusBadge = '<span style="background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 12px; font-size: 12px;">‚è∏Ô∏è ‰∏≠Êñ≠‰∏≠</span>';
                                        }
                                        
                                        if (latestRecord) {
                                            if (latestRecord.status === 'completed') {
                                                if (latestRecord.passed) {
                                                    statusBadge = '<span style="background: #d1fae5; color: #065f46; padding: 4px 12px; border-radius: 12px; font-size: 12px;">‚úÖ ‰øÆ‰∫Ü</span>';
                                                    certificate = '<button class="btn btn-success btn-small" onclick="App.viewCertificate(' + learner.id + ')">üìú Ë°®Á§∫</button>';
                                                } else {
                                                    statusBadge = '<span style="background: #fee2e2; color: #991b1b; padding: 4px 12px; border-radius: 12px; font-size: 12px;">‚ùå ‰∏çÂêàÊ†º</span>';
                                                }
                                                testResult = `<span style="color: ${latestRecord.passed ? '#10b981' : '#ef4444'}; font-weight: 600;">${latestRecord.score}ÁÇπ / ${latestRecord.totalQuestions}Âïè</span>`;
                                            }
                                        }
                                        
                                        return `
                                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                                <td style="padding: 15px;">${learner.name}</td>
                                                <td style="padding: 15px;">${learner.department}</td>
                                                <td style="padding: 15px;">${learner.email}</td>
                                                <td style="padding: 15px; text-align: center;">${statusBadge}</td>
                                                <td style="padding: 15px; text-align: center;">${testResult}</td>
                                                <td style="padding: 15px; text-align: center;">${certificate}</td>
                                                <td style="padding: 15px; text-align: center;">
                                                    <button class="btn btn-primary btn-small" onclick="App.viewLearnerDetail(${learner.id})">
                                                        Ë©≥Á¥∞
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `}
                `;
            },

            renderCourses() {
                if (AppData.courses.length === 0) {
                    return `
                        <div class="section-header">
                            <h2>„Ç≥„Éº„ÇπÁÆ°ÁêÜ</h2>
                        </div>
                        <div style="text-align: center; padding: 60px;">
                            <div style="font-size: 64px; margin-bottom: 20px;">üìö</div>
                            <h3>„Ç≥„Éº„Çπ„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="App.switchTab('import')">
                                ÊúÄÂàù„ÅÆ„Ç≥„Éº„Çπ„Çí„Ç§„É≥„Éù„Éº„Éà
                            </button>
                        </div>
                    `;
                }

                return `
                    <div class="section-header">
                        <h2>„Ç≥„Éº„ÇπÁÆ°ÁêÜ</h2>
                        <button class="btn btn-primary" onclick="App.switchTab('import')">
                            ‚ûï Êñ∞Ë¶è„Ç§„É≥„Éù„Éº„Éà
                        </button>
                    </div>

                    ${AppData.courses.map(course => `
                        <div class="course-card">
                            <h3 style="color: #1e3c72; margin-bottom: 10px;">${course.title}</h3>
                            <p style="color: #6b7280; margin-bottom: 15px;">${course.subtitle || ''}</p>
                            
                            <div class="course-structure">
                                <h4 style="margin-bottom: 15px;">„Ç≥„Éº„ÇπÊßãÊàê</h4>
                                
                                <div class="structure-item">
                                    <span class="section-badge badge-training">Á†î‰øÆ</span>
                                    <span>${course.sections.training.slideCount} „Çπ„É©„Ç§„Éâ</span>
                                    ${course.slideImages && course.slideImages.length > 0 ? 
                                        `<span style="color: #10b981; margin-left: 10px;">‚úÖ ${course.slideImages.length}Êûö„ÅÆÁîªÂÉè</span>` : 
                                        `<span style="color: #f59e0b; margin-left: 10px;">‚ö†Ô∏è „Éá„É¢Áî®</span>`}
                                </div>

                                <div class="structure-item">
                                    <span class="section-badge badge-test">„ÉÜ„Çπ„Éà</span>
                                    <span>${course.sections.test.questions.length} Âïè</span>
                                </div>
                            </div>

                            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary btn-small" onclick="App.startLearning(${course.id})">
                                    üéì ÂèóË¨õ„Åô„Çã
                                </button>
                                <button class="btn btn-danger btn-small" onclick="App.deleteCourse(${course.id})">
                                    üóëÔ∏è ÂâäÈô§
                                </button>
                            </div>
                        </div>
                    `).join('')}
                `;
            },

            renderImport() {
                return `
                    <div class="section-header">
                        <h2>PowerPoint„Ç§„É≥„Éù„Éº„Éà</h2>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="file-upload-area" id="pptxUploadArea" style="border-color: #667eea; background: #f0f4ff;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üìÑ</div>
                            <h3 style="color: #1e3c72;">STEP 1: PPTX„Éï„Ç°„Ç§„É´</h3>
                            <p style="color: #6b7280; margin: 20px 0;">
                                PowerPoint„Éï„Ç°„Ç§„É´„Åã„Çâ<br>ÂïèÈ°å„ÇíËá™ÂãïÊäΩÂá∫
                            </p>
                            <input type="file" id="courseFile" accept=".pptx" style="display: none;" />
                            <button class="btn btn-primary" onclick="document.getElementById('courseFile').click()">
                                üìÑ PPTX„ÇíÈÅ∏Êäû
                            </button>
                            <div id="pptxStatus" style="margin-top: 15px; font-size: 14px;"></div>
                        </div>

                        <div class="file-upload-area" id="imageUploadArea" style="border-color: #10b981; background: #f0fdf4;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üñºÔ∏è</div>
                            <h3 style="color: #065f46;">STEP 2: „Çπ„É©„Ç§„ÉâÁîªÂÉè</h3>
                            <p style="color: #6b7280; margin: 20px 0;">
                                PowerPoint„Åã„Çâ<br>„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„ÅüÁîªÂÉè„ÇíÈÅ∏Êäû
                            </p>
                            <input type="file" id="imageFiles" accept="image/png,image/jpeg,image/jpg" multiple style="display: none;" />
                            <input type="file" id="imageZipFile" accept=".zip" style="display: none;" />
                            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                <button class="btn btn-success" onclick="document.getElementById('imageFiles').click()">
                                    üñºÔ∏è ÁîªÂÉè„ÇíÈÅ∏Êäû
                                </button>
                                <button class="btn btn-success" onclick="document.getElementById('imageZipFile').click()">
                                    üì¶ ZIP„ÇíÈÅ∏Êäû
                                </button>
                            </div>
                            <div id="imageStatus" style="margin-top: 15px; font-size: 14px;"></div>
                        </div>
                    </div>

                    <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #92400e; margin-bottom: 15px;">üí° PowerPoint„Åã„ÇâÁîªÂÉè„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„ÇãÊñπÊ≥ï</h4>
                        <ol style="color: #78350f; line-height: 2; margin-left: 20px;">
                            <li>PowerPoint„ÇíÈñã„Åè</li>
                            <li>„Äå„Éï„Ç°„Ç§„É´„Äç‚Üí„Äå„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Äç‚Üí„Äå„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„ÅÆÂ§âÊõ¥„Äç„ÇíÈÅ∏Êäû</li>
                            <li>„ÄåPNG„Äç„Åæ„Åü„ÅØ„ÄåJPEG„Äç„ÇíÈÅ∏Êäû</li>
                            <li>„Äå„Åô„Åπ„Å¶„ÅÆ„Çπ„É©„Ç§„Éâ„Äç„ÇíÈÅ∏Êäû„Åó„Å¶„Ç®„ÇØ„Çπ„Éù„Éº„Éà</li>
                            <li>„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åï„Çå„ÅüÁîªÂÉè„Çí„Åì„Åì„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</li>
                        </ol>
                    </div>

                    <div id="processingIndicator" class="processing-indicator">
                        <div class="spinner"></div>
                        <h3 style="color: #1e3c72;">Ëß£Êûê‰∏≠...</h3>
                    </div>

                    <div id="analysisResult" class="analysis-result">
                        <h3 style="color: #1e3c72; margin-bottom: 20px;">üìä Ëß£ÊûêÁµêÊûú</h3>
                        <div id="analysisContent"></div>
                        <div style="margin-top: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="App.saveCourse()">
                                ‚úÖ ‰øùÂ≠ò
                            </button>
                            <button class="btn btn-secondary" onclick="App.cancelImport()">
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>
                `;
            },

            renderLearning() {
                const state = AppData.learningState;
                const totalSlides = slideImages.length || 19;
                const totalQuestions = EXTRACTED_QUESTIONS.length;
                
                let progress = 0;
                if (state.screen === 'training') {
                    progress = ((state.slideIndex + 1) / totalSlides) * 50;
                } else if (state.screen === 'quiz') {
                    progress = 50 + (Object.keys(state.answers).length / totalQuestions) * 50;
                } else if (state.screen === 'result') {
                    progress = 100;
                }

                let content = '';

                if (state.screen === 'start') {
                    content = this.renderStartScreen(totalSlides, totalQuestions);
                } else if (state.screen === 'training') {
                    content = this.renderTrainingScreen(state, totalSlides);
                } else if (state.screen === 'quiz') {
                    content = this.renderQuizScreen(state, totalQuestions);
                } else if (state.screen === 'result') {
                    content = this.renderResultScreen(state, totalQuestions);
                }

                return `
                    <div class="app-container">
                        <div class="header">
                            <div class="header-left">
                                <h1>„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å´„Åä„Åë„ÇãÂèñÂºïÊé®Â•®Ë°åÁÇ∫</h1>
                                <p>PE„Éï„Ç°„É≥„ÉâÂæìÊ•≠Âì°Âêë„Åëe„É©„Éº„Éã„É≥„Ç∞Á†î‰øÆ</p>
                                ${state.screen !== 'start' ? `
                                    <div class="progress-bar-container">
                                        <div class="progress-bar" style="width: ${progress}%"></div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="header-right" style="text-align: right;">
                                <div style="color: white; margin-bottom: 10px;">
                                    üë§ ${AppData.currentUser.name}
                                </div>
                                ${AppData.currentUser.role === 'admin' ? `
                                    <button class="btn btn-logout btn-small" onclick="App.backToAdmin()">
                                        ÁÆ°ÁêÜÁîªÈù¢„Å∏
                                    </button>
                                ` : `
                                    <button class="btn btn-logout btn-small" onclick="App.logout()">
                                        „É≠„Ç∞„Ç¢„Ç¶„Éà
                                    </button>
                                `}
                            </div>
                        </div>
                        <div class="content-area">
                            ${content}
                        </div>
                    </div>
                `;
            },

            renderStartScreen(totalSlides, totalQuestions) {
                const progress = AppData.savedProgress;
                
                return `
                    ${progress ? `
                        <div class="resume-banner">
                            <div class="resume-banner-content">
                                <div class="resume-banner-title">‚è∏Ô∏è ÂâçÂõû„ÅÆÁ∂ö„Åç„Åå„ÅÇ„Çä„Åæ„Åô</div>
                                <div class="resume-banner-text">
                                    ${progress.screen === 'training' ? 
                                        `Á†î‰øÆ„Çπ„É©„Ç§„Éâ ${progress.slideIndex + 1}/${totalSlides} „Åæ„ÅßÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô` :
                                        `„ÉÜ„Çπ„Éà ${Object.keys(progress.answers || {}).length}/${totalQuestions} Âïè„Åæ„ÅßÂõûÁ≠îÊ∏à„Åø„Åß„Åô`
                                    }
                                    <br>ÊúÄÁµÇÊõ¥Êñ∞: ${new Date(progress.lastUpdated).toLocaleString('ja-JP')}
                                </div>
                            </div>
                            <div class="resume-banner-actions">
                                <button class="btn btn-success" onclick="App.resumeLearning()">
                                    ‚ñ∂Ô∏è Á∂ö„Åç„Åã„ÇâÂÜçÈñã
                                </button>
                                <button class="btn btn-secondary" onclick="App.startFromBeginning()">
                                    üîÑ ÊúÄÂàù„Åã„Çâ
                                </button>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="start-screen">
                        <h2>„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂ e„É©„Éº„Éã„É≥„Ç∞Á†î‰øÆ„Å∏„Çà„ÅÜ„Åì„Åù</h2>
                        <p>Êú¨Á†î‰øÆ„Åß„ÅØ„ÄÅÈáëËûçÂïÜÂìÅÂèñÂºïÊ≥ï„Å´„Åä„Åë„Çã„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„ÄÅÁâπ„Å´„ÄåÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Äç„Å´„Å§„ÅÑ„Å¶Â≠¶Áøí„Åó„Åæ„Åô„ÄÇ</p>
                        
                        <div class="course-info">
                            <h3>üìö Á†î‰øÆÂÜÖÂÆπ</h3>
                            <ul>
                                <li><span>üìñ</span> <span>Á†î‰øÆ„Çπ„É©„Ç§„Éâ: ${totalSlides}Êûö</span></li>
                                <li><span>‚úèÔ∏è</span> <span>Á¢∫Ë™ç„ÉÜ„Çπ„Éà: 4ÊäûÂºèÂïèÈ°å ${totalQuestions}Âïè</span></li>
                                <li><span>‚è±Ô∏è</span> <span>ÊâÄË¶ÅÊôÇÈñì: Á¥Ñ30„Äú40ÂàÜ</span></li>
                                <li><span>üéØ</span> <span>ÂêàÊ†ºÂü∫Ê∫ñ: ${totalQuestions}Âïè‰∏≠8Âïè‰ª•‰∏äÊ≠£Ëß£</span></li>
                                <li><span>üèÜ</span> <span>‰øÆ‰∫ÜË®º: ÂêàÊ†ºËÄÖ„Å´Áô∫Ë°å</span></li>
                                <li><span>üíæ</span> <span><strong>ÈÄî‰∏≠„Åß‰∏≠Êñ≠„Åó„Å¶„ÇÇÈÄ≤Ë°åÁä∂Ê≥Å„ÇíDB„Å´‰øùÂ≠ò</strong></span></li>
                            </ul>
                        </div>

                        <div style="margin: 40px auto; max-width: 400px;">
                            ${!progress ? `
                                <div class="form-group">
                                    <label>Ê∞èÂêç <span style="color: #ef4444;">*</span></label>
                                    <input type="text" id="userName" placeholder="Â±±Áî∞ Â§™ÈÉé" value="${AppData.currentUser.name}">
                                </div>
                                <div class="form-group">
                                    <label>ÊâÄÂ±ûÈÉ®ÁΩ≤ <span style="color: #ef4444;">*</span></label>
                                    <input type="text" id="userDept" placeholder="„Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®" value="${AppData.currentUser.department || ''}">
                                </div>
                                <button class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 18px;" onclick="App.startTraining()">
                                    Á†î‰øÆ„ÇíÈñãÂßã„Åô„Çã ‚Üí
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            },

            renderTrainingScreen(state, totalSlides) {
                const courseImages = AppData.currentCourse && AppData.currentCourse.slideImages 
                    ? AppData.currentCourse.slideImages 
                    : [];
                
                let imageToShow = null;
                
                if (courseImages.length > state.slideIndex) {
                    imageToShow = courseImages[state.slideIndex].data;
                } else if (slideImages.length > state.slideIndex) {
                    imageToShow = slideImages[state.slideIndex];
                }
                
                return `
                    <div class="slide-container">
                        <button class="btn btn-secondary slide-nav-button" 
                                ${state.slideIndex === 0 ? 'disabled' : ''}
                                onclick="App.prevSlide()">
                            ‚Üê Ââç„Å∏
                        </button>
                        
                        <div class="slide-content-wrapper">
                            <div style="text-align: center; margin-bottom: 20px; width: 100%;">
                                <div style="color: #667eea; font-weight: 600; font-size: 20px;">
                                    „Çπ„É©„Ç§„Éâ ${state.slideIndex + 1} / ${totalSlides}
                                </div>
                            </div>
                            
                            ${imageToShow ? 
                                `<img src="${imageToShow}" alt="„Çπ„É©„Ç§„Éâ ${state.slideIndex + 1}" class="slide-image">` :
                                `<div style="padding: 100px; background: #f9fafb; border-radius: 8px;">
                                    <p style="font-size: 24px; color: #1e3c72; margin-bottom: 20px;">üìÑ „Çπ„É©„Ç§„Éâ ${state.slideIndex + 1}</p>
                                    <p style="color: #6b7280;">‚Äª ÁîªÂÉè„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                </div>`
                            }
                        </div>
                        
                        ${state.slideIndex < totalSlides - 1 ? 
                            `<button class="btn btn-primary slide-nav-button" onclick="App.nextSlide()">Ê¨°„Å∏ ‚Üí</button>` :
                            `<button class="btn btn-success slide-nav-button" onclick="App.startQuiz()">„ÉÜ„Çπ„Éà„Å∏ÈÄ≤„ÇÄ ‚Üí</button>`
                        }
                    </div>
                `;
            },

            renderQuizScreen(state, totalQuestions) {
                const question = EXTRACTED_QUESTIONS[state.questionIndex];
                const userAnswer = state.answers[question.id];
                const showExplanation = state.showExplanations[question.id];

                return `
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">
                                ÂïèÈ°å ${state.questionIndex + 1} / ${totalQuestions}
                            </div>
                            <div style="color: #3b82f6; font-size: 12px;">üíæ ÂõûÁ≠î„ÅØËá™Âãï‰øùÂ≠ò„Åï„Çå„Åæ„Åô</div>
                        </div>

                        <div class="question-text">
                            ${question.question}
                        </div>

                        <div class="options">
                            ${question.options.map((option, index) => {
                                let optionClass = 'option';
                                if (userAnswer !== undefined) {
                                    if (index === question.correctAnswer) {
                                        optionClass += ' correct';
                                    } else if (index === userAnswer) {
                                        optionClass += ' incorrect';
                                    }
                                }

                                return `
                                    <div class="${optionClass}" 
                                         onclick="${userAnswer === undefined ? `App.selectAnswer(${question.id}, ${index})` : ''}">
                                        <div class="option-label">${String.fromCharCode(65 + index)}.</div>
                                        <div style="flex: 1;">${option}</div>
                                        ${userAnswer !== undefined && index === question.correctAnswer ? 
                                            '<div style="color: #10b981; font-weight: 700;">‚úì Ê≠£Ëß£</div>' : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        ${userAnswer !== undefined && showExplanation ? `
                            <div class="explanation-box">
                                <div class="explanation-title">üìñ Ëß£Ë™¨</div>
                                <div class="explanation-text">${question.explanation}</div>
                            </div>
                        ` : ''}

                        <div class="navigation">
                            <button class="btn btn-secondary" 
                                    ${state.questionIndex === 0 ? 'disabled' : ''}
                                    onclick="App.prevQuestion()">
                                ‚Üê Ââç„ÅÆÂïèÈ°å
                            </button>
                            <div>
                                ${userAnswer !== undefined && !showExplanation ? 
                                    `<button class="btn btn-warning" onclick="App.showExplanation(${question.id})">
                                        Ëß£Ë™¨„ÇíË°®Á§∫
                                    </button>` : ''}
                            </div>
                            ${state.questionIndex < totalQuestions - 1 ? 
                                `<button class="btn btn-primary" 
                                         ${userAnswer === undefined ? 'disabled' : ''}
                                         onclick="App.nextQuestion()">
                                    Ê¨°„ÅÆÂïèÈ°å ‚Üí
                                </button>` :
                                `<button class="btn btn-success" 
                                         ${userAnswer === undefined ? 'disabled' : ''}
                                         onclick="App.finishQuiz()">
                                    ÁµêÊûú„ÇíË°®Á§∫ ‚Üí
                                </button>`
                            }
                        </div>
                    </div>
                `;
            },

            renderResultScreen(state, totalQuestions) {
                const correctCount = Object.entries(state.answers).filter(([questionId, answer]) => {
                    const question = EXTRACTED_QUESTIONS.find(q => q.id == questionId);
                    return question && answer === question.correctAnswer;
                }).length;

                const score = Math.round((correctCount / totalQuestions) * 100);
                const passed = correctCount >= 8;

                return `
                    <div class="quiz-result">
                        <h2 style="color: #1e3c72;">Á†î‰øÆ„ÉÜ„Çπ„ÉàÁµêÊûú</h2>
                        
                        <div class="score-display">${correctCount} / ${totalQuestions}</div>
                        
                        <div class="result-message ${passed ? 'pass' : 'fail'}">
                            ${passed ? 'üéâ ÂêàÊ†º„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô!' : 'üò¢ ‰∏çÂêàÊ†º„Åß„Åô'}
                        </div>

                        <p style="font-size: 18px; color: #6b7280; margin: 20px 0;">
                            Ê≠£Á≠îÁéá: ${score}%
                        </p>

                        ${passed ? `
                            <div class="certificate-container">
                                <div class="certificate-title">üèÜ ‰øÆ‰∫ÜË®º</div>
                                <div class="certificate-body">
                                    <p style="font-size: 20px; margin-bottom: 20px;">‰ª•‰∏ã„ÅÆËÄÖ„ÅØ</p>
                                    <div class="certificate-name">${state.userName}</div>
                                    <p style="margin: 20px 0; line-height: 1.8;">
                                        „Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å´„Åä„Åë„Çã<br>
                                        ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Å´Èñ¢„Åô„ÇãÁ†î‰øÆ„Çí<br>
                                        ‰øÆ‰∫Ü„Åó„Åü„Åì„Å®„ÇíË®ºÊòé„Åó„Åæ„Åô
                                    </p>
                                    <p style="margin-top: 30px; color: #6b7280;">
                                        ${new Date().toLocaleDateString('ja-JP')}
                                    </p>
                                    <p style="margin-top: 10px; font-weight: 600;">
                                        ${state.userDept}
                                    </p>
                                </div>
                            </div>

                            <button class="btn btn-primary" onclick="window.print()">
                                üñ®Ô∏è ‰øÆ‰∫ÜË®º„ÇíÂç∞Âà∑
                            </button>
                        ` : `
                            <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 12px; padding: 25px; margin: 30px auto; max-width: 600px;">
                                <p style="color: #92400e; line-height: 1.8;">
                                    ÂêàÊ†ºÂü∫Ê∫ñ„ÅØ${totalQuestions}Âïè‰∏≠8Âïè‰ª•‰∏ä„ÅÆÊ≠£Ëß£„Åß„Åô„ÄÇ<br>
                                    „ÇÇ„ÅÜ‰∏ÄÂ∫¶Á†î‰øÆË≥áÊñô„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂÜç„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                </p>
                            </div>

                            <button class="btn btn-warning" onclick="App.retakeQuiz()">
                                „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÂèóË¨õ„Åô„Çã
                            </button>
                        `}
                    </div>
                `;
            },

            attachLoginListeners() {
                const passwordInput = document.getElementById('password');
                if (passwordInput) {
                    passwordInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.login();
                    });
                }
            },

            attachAdminListeners() {
                const fileInput = document.getElementById('courseFile');
                if (fileInput) {
                    fileInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            await this.handleFileUpload(file);
                        }
                    });
                }

                const imageInput = document.getElementById('imageFiles');
                if (imageInput) {
                    imageInput.addEventListener('change', async (e) => {
                        const files = Array.from(e.target.files);
                        if (files.length > 0) {
                            await this.handleImageUpload(files);
                        }
                    });
                }

                const zipInput = document.getElementById('imageZipFile');
                if (zipInput) {
                    zipInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            await this.handleZipUpload(file);
                        }
                    });
                }
            },

            attachLearningListeners() {},

            async login() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                const user = AppData.users.find(u => 
                    u.username === username && u.password === password
                );

                if (user) {
                    AppData.currentUser = user;
                    const progress = await Database.loadProgress(user.id);
                    if (progress) {
                        AppData.savedProgress = progress;
                    }
                    
                    if (AppData.courses.length > 0) {
                        AppData.currentCourse = AppData.courses[0];
                    }
                    
                    if (user.role === 'admin') {
                        this.currentView = 'admin';
                    } else {
                        this.currentView = 'learning';
                    }
                    this.render();
                } else {
                    alert('„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            },

            async logout() {
                if (confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„Åã?')) {
                    if (AppData.currentUser && 
                        (AppData.learningState.screen === 'training' || 
                         AppData.learningState.screen === 'quiz')) {
                        await Database.saveProgress(AppData.currentUser.id);
                    }
                    
                    AppData.currentUser = null;
                    AppData.savedProgress = null;
                    this.currentView = 'login';
                    AppData.learningState = {
                        screen: 'start',
                        slideIndex: 0,
                        questionIndex: 0,
                        userName: '',
                        userDept: '',
                        answers: {},
                        showExplanations: {}
                    };
                    this.render();
                }
            },

            switchTab(tab) {
                this.currentTab = tab;
                this.render();
            },

            async switchToLearning() {
                if (AppData.courses.length > 0 && !AppData.currentCourse) {
                    AppData.currentCourse = AppData.courses[0];
                }
                
                this.currentView = 'learning';
                if (AppData.currentUser) {
                    const progress = await Database.loadProgress(AppData.currentUser.id);
                    if (progress) {
                        AppData.savedProgress = progress;
                    }
                }
                this.render();
            },

            async backToAdmin() {
                if (AppData.currentUser && 
                    (AppData.learningState.screen === 'training' || 
                     AppData.learningState.screen === 'quiz')) {
                    await Database.saveProgress(AppData.currentUser.id);
                }
                this.currentView = 'admin';
                this.render();
            },

            async startLearning(courseId) {
                if (courseId) {
                    const course = AppData.courses.find(c => c.id === courseId);
                    if (course) {
                        AppData.currentCourse = course;
                    }
                } else if (AppData.courses.length > 0) {
                    AppData.currentCourse = AppData.courses[0];
                }
                
                if (AppData.currentUser) {
                    const progress = await Database.loadProgress(AppData.currentUser.id);
                    if (progress) {
                        AppData.savedProgress = progress;
                    }
                }
                
                this.currentView = 'learning';
                AppData.learningState.screen = 'start';
                this.render();
            },

            resumeLearning() {
                if (AppData.savedProgress) {
                    AppData.learningState = {
                        ...AppData.savedProgress,
                        answers: AppData.savedProgress.answers || {},
                        showExplanations: AppData.savedProgress.showExplanations || {}
                    };
                    
                    if (AppData.savedProgress.courseId) {
                        const course = AppData.courses.find(c => c.id === AppData.savedProgress.courseId);
                        if (course) {
                            AppData.currentCourse = course;
                        }
                    }
                    
                    AppData.savedProgress = null;
                    this.render();
                }
            },

            async startFromBeginning() {
                if (confirm('ÂâçÂõû„ÅÆÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÂâäÈô§„Åó„Å¶„ÄÅÊúÄÂàù„Åã„ÇâÈñãÂßã„Åó„Åæ„Åô„Åã?')) {
                    if (AppData.currentUser) {
                        await Database.clearProgress(AppData.currentUser.id);
                    }
                    AppData.savedProgress = null;
                    
                    if (!AppData.currentCourse && AppData.courses.length > 0) {
                        AppData.currentCourse = AppData.courses[0];
                    }
                    
                    AppData.learningState = {
                        screen: 'start',
                        slideIndex: 0,
                        questionIndex: 0,
                        userName: AppData.currentUser.name,
                        userDept: AppData.currentUser.department || '',
                        answers: {},
                        showExplanations: {}
                    };
                    this.render();
                }
            },

            async handleFileUpload(file) {
                const processingIndicator = document.getElementById('processingIndicator');
                const analysisResult = document.getElementById('analysisResult');
                
                if (processingIndicator) processingIndicator.classList.add('active');
                if (analysisResult) analysisResult.classList.remove('active');

                try {
                    const result = await PPTXAnalyzer.analyzePPTX(file);
                    AppData.analysisResult = result;
                    
                    if (processingIndicator) processingIndicator.classList.remove('active');
                    
                    if (result) {
                        this.displayAnalysisResult(result);
                        const statusDiv = document.getElementById('pptxStatus');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<span style="color: #10b981;">‚úÖ PPTX„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü</span>';
                        }
                    }
                } catch (error) {
                    alert('„Ç®„É©„Éº: ' + error.message);
                    if (processingIndicator) processingIndicator.classList.remove('active');
                }
            },

            async handleImageUpload(files) {
                const statusDiv = document.getElementById('imageStatus');
                
                try {
                    if (statusDiv) {
                        statusDiv.innerHTML = `<span style="color: #667eea;">üìä ${files.length}Êûö„ÅÆÁîªÂÉè„ÇíÂá¶ÁêÜ‰∏≠...</span>`;
                    }

                    const sortedFiles = files.sort((a, b) => {
                        const numA = parseInt(a.name.match(/\d+/) || 0);
                        const numB = parseInt(b.name.match(/\d+/) || 0);
                        return numA - numB;
                    });

                    const imageData = [];
                    for (const file of sortedFiles) {
                        if (file.type.startsWith('image/')) {
                            const base64 = await this.fileToBase64(file);
                            imageData.push({
                                name: file.name,
                                data: base64,
                                mimeType: file.type
                            });
                        }
                    }

                    PPTXAnalyzer.extractedImages = imageData;

                    if (statusDiv) {
                        statusDiv.innerHTML = `<span style="color: #10b981;">‚úÖ ${imageData.length}Êûö„ÅÆÁîªÂÉè„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü</span>`;
                    }

                    if (AppData.analysisResult) {
                        this.displayAnalysisResult(AppData.analysisResult);
                    }
                } catch (error) {
                    console.error('ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Ç®„É©„Éº:', error);
                    if (statusDiv) {
                        statusDiv.innerHTML = `<span style="color: #ef4444;">‚ùå „Ç®„É©„Éº: ${error.message}</span>`;
                    }
                }
            },

            async handleZipUpload(file) {
                const statusDiv = document.getElementById('imageStatus');
                
                try {
                    if (statusDiv) {
                        statusDiv.innerHTML = '<span style="color: #667eea;">üì¶ ZIP„Éï„Ç°„Ç§„É´„ÇíËß£Âáç‰∏≠...</span>';
                    }

                    const zip = await JSZip.loadAsync(file);
                    const imageFiles = [];

                    const fileList = Object.keys(zip.files)
                        .filter(name => {
                            const lower = name.toLowerCase();
                            return (lower.endsWith('.png') || lower.endsWith('.jpg') || lower.endsWith('.jpeg')) 
                                   && !name.startsWith('__MACOSX');
                        })
                        .sort();

                    for (const filename of fileList) {
                        const fileData = zip.files[filename];
                        const blob = await fileData.async('blob');
                        const base64 = await this.blobToBase64(blob);
                        
                        let mimeType = 'image/png';
                        if (filename.toLowerCase().endsWith('.jpg') || filename.toLowerCase().endsWith('.jpeg')) {
                            mimeType = 'image/jpeg';
                        }

                        imageFiles.push({
                            name: filename,
                            data: base64,
                            mimeType: mimeType
                        });
                    }

                    PPTXAnalyzer.extractedImages = imageFiles;

                    if (statusDiv) {
                        statusDiv.innerHTML = `<span style="color: #10b981;">‚úÖ ${imageFiles.length}Êûö„ÅÆÁîªÂÉè„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü</span>`;
                    }

                    if (AppData.analysisResult) {
                        this.displayAnalysisResult(AppData.analysisResult);
                    }
                } catch (error) {
                    console.error('ZIP„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Ç®„É©„Éº:', error);
                    if (statusDiv) {
                        statusDiv.innerHTML = `<span style="color: #ef4444;">‚ùå „Ç®„É©„Éº: ${error.message}</span>`;
                    }
                }
            },

            fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },

            blobToBase64(blob) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            },

            displayAnalysisResult(result) {
                const analysisContent = document.getElementById('analysisContent');
                const analysisResult = document.getElementById('analysisResult');
                
                if (!analysisContent || !analysisResult) return;

                const imageCount = PPTXAnalyzer.extractedImages.length;
                
                if (!result && imageCount > 0) {
                    analysisContent.innerHTML = `
                        <div class="analysis-section" style="border: 2px solid #10b981;">
                            <h4>
                                <span class="section-badge badge-training">„Çπ„É©„Ç§„ÉâÁîªÂÉè</span>
                                ${imageCount} ÊûöË™≠„ÅøËæº„ÅøÂÆå‰∫Ü ‚úÖ
                            </h4>
                            <p style="color: #065f46; font-weight: 600;">ÁîªÂÉè„Éï„Ç°„Ç§„É´„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü!</p>
                        </div>

                        <div class="analysis-section">
                            <h4>
                                <span class="section-badge badge-test">Á¢∫Ë™ç„ÉÜ„Çπ„Éà</span>
                                ${EXTRACTED_QUESTIONS.length} Âïè(ÁµÑ„ÅøËæº„ÅøÊ∏à„Åø) ‚úÖ
                            </h4>
                        </div>
                    `;
                    analysisResult.classList.add('active');
                    return;
                }

                if (!result) return;

                analysisContent.innerHTML = `
                    <div class="analysis-section">
                        <h4>üìÑ „Éï„Ç°„Ç§„É´ÊÉÖÂ†±</h4>
                        <p><strong>„Éï„Ç°„Ç§„É´Âêç:</strong> ${result.fileName}</p>
                        <p><strong>Á∑è„Çπ„É©„Ç§„ÉâÊï∞:</strong> ${result.totalSlides} „Çπ„É©„Ç§„Éâ</p>
                        ${imageCount > 0 ? 
                            `<p style="color: #10b981;"><strong>‚úÖ ÊäΩÂá∫ÁîªÂÉè:</strong> ${imageCount}Êûö</p>` :
                            `<p style="color: #f59e0b;"><strong>‚ö†Ô∏è ÁîªÂÉèÊäΩÂá∫:</strong> 0Êûö(„Éá„É¢Áî®„Çπ„É©„Ç§„Éâ„Çí‰ΩøÁî®)</p>`}
                    </div>

                    ${imageCount > 0 ? `
                        <div class="analysis-section" style="border: 2px solid #10b981;">
                            <h4>
                                <span class="section-badge badge-training">„Çπ„É©„Ç§„ÉâÁîªÂÉè</span>
                                ${imageCount} ÊûöÊäΩÂá∫ ‚úÖ
                            </h4>
                            <p style="color: #065f46; font-weight: 600;">ÂÆüÈöõ„ÅÆPowerPoint„Çπ„É©„Ç§„ÉâÁîªÂÉè„ÇíÊäΩÂá∫„Åó„Åæ„Åó„Åü!</p>
                        </div>
                    ` : ''}

                    <div class="analysis-section" style="border: 2px solid #10b981;">
                        <h4>
                            <span class="section-badge badge-test">Á¢∫Ë™ç„ÉÜ„Çπ„Éà</span>
                            ${result.sections.test.questions.length} ÂïèÊ§úÂá∫ ‚úÖ
                        </h4>
                        <p style="color: #065f46; font-weight: 600;">ÂÖ®10Âïè„ÇíÊ≠£„Åó„ÅèÊäΩÂá∫„Åó„Åæ„Åó„Åü!</p>
                        <div class="question-list">
                            ${result.sections.test.questions.map(q => `
                                <div class="question-item">Q${q.number}</div>
                            `).join('')}
                        </div>
                    </div>
                `;

                analysisResult.classList.add('active');
            },

            async saveCourse() {
                if (!AppData.analysisResult && PPTXAnalyzer.extractedImages.length === 0) {
                    alert('‚ùå PPTX„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØÁîªÂÉè„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                const result = AppData.analysisResult || {
                    fileName: 'ÊâãÂãï‰ΩúÊàê„Ç≥„Éº„Çπ',
                    totalSlides: PPTXAnalyzer.extractedImages.length || 19,
                    sections: {
                        training: {
                            name: 'Á†î‰øÆ„ÉÜ„Ç≠„Çπ„Éà',
                            slideCount: Math.max(PPTXAnalyzer.extractedImages.length || 19, 19),
                            topics: []
                        },
                        test: {
                            name: 'Á¢∫Ë™ç„ÉÜ„Çπ„Éà',
                            slideCount: 10,
                            questions: EXTRACTED_QUESTIONS
                        },
                        explanation: {
                            name: 'Ëß£Ë™¨',
                            slideCount: 0,
                            topics: []
                        }
                    },
                    metadata: {
                        title: '„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å´„Åä„Åë„ÇãÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Å´Èñ¢„Åô„ÇãÁ†î‰øÆ',
                        subtitle: 'PE„Éï„Ç°„É≥„ÉâÂæìÊ•≠Âì°Âêë„Åë',
                        date: new Date().toISOString().split('T')[0]
                    }
                };

                const newCourse = {
                    id: Date.now(),
                    title: result.metadata.title,
                    subtitle: result.metadata.subtitle,
                    totalSlides: result.totalSlides,
                    sections: result.sections,
                    createdAt: result.metadata.date,
                    slideImages: PPTXAnalyzer.extractedImages
                };

                AppData.courses.push(newCourse);
                AppData.currentCourse = newCourse;
                
                // Âç≥Â∫ß„Å´DB„Å´‰øùÂ≠ò
                await Database.save();
                
                alert('‚úÖ „Ç≥„Éº„Çπ„ÇíDB„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü!' + 
                      (PPTXAnalyzer.extractedImages.length > 0 ? 
                       `\n${PPTXAnalyzer.extractedImages.length}Êûö„ÅÆÁîªÂÉè„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü„ÄÇ` : 
                       '\n‚Äª „Éá„É¢Áî®„Çπ„É©„Ç§„Éâ„Åå‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ'));
                
                this.switchTab('courses');
            },

            cancelImport() {
                AppData.analysisResult = null;
                PPTXAnalyzer.extractedImages = [];
                this.render();
            },

            async deleteCourse(id) {
                if (confirm('„Åì„ÅÆ„Ç≥„Éº„Çπ„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                    AppData.courses = AppData.courses.filter(c => c.id !== id);
                    await Database.save();
                    this.render();
                }
            },

            async startTraining() {
                const userName = document.getElementById('userName').value;
                const userDept = document.getElementById('userDept').value;

                if (!userName || !userDept) {
                    alert('Ê∞èÂêç„Å®ÊâÄÂ±ûÈÉ®ÁΩ≤„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                
                if (!AppData.currentCourse && AppData.courses.length > 0) {
                    AppData.currentCourse = AppData.courses[0];
                }

                AppData.learningState.userName = userName;
                AppData.learningState.userDept = userDept;
                AppData.learningState.screen = 'training';
                AppData.learningState.slideIndex = 0;
                
                if (AppData.currentUser) {
                    await Database.saveProgress(AppData.currentUser.id);
                }
                
                this.render();
            },

            async nextSlide() {
                AppData.learningState.slideIndex++;
                if (AppData.currentUser) {
                    await Database.saveProgress(AppData.currentUser.id);
                }
                this.render();
            },

            prevSlide() {
                AppData.learningState.slideIndex--;
                this.render();
            },

            async startQuiz() {
                AppData.learningState.screen = 'quiz';
                AppData.learningState.questionIndex = 0;
                if (AppData.currentUser) {
                    await Database.saveProgress(AppData.currentUser.id);
                }
                this.render();
            },

            async selectAnswer(questionId, answer) {
                AppData.learningState.answers[questionId] = answer;
                if (AppData.currentUser) {
                    await Database.saveProgress(AppData.currentUser.id);
                }
                this.render();
            },

            showExplanation(questionId) {
                AppData.learningState.showExplanations[questionId] = true;
                this.render();
            },

            nextQuestion() {
                AppData.learningState.questionIndex++;
                this.render();
            },

            prevQuestion() {
                AppData.learningState.questionIndex--;
                this.render();
            },

            async finishQuiz() {
                AppData.learningState.screen = 'result';
                
                const totalQuestions = EXTRACTED_QUESTIONS.length;
                const correctCount = Object.entries(AppData.learningState.answers).filter(([questionId, answer]) => {
                    const question = EXTRACTED_QUESTIONS.find(q => q.id == questionId);
                    return question && answer === question.correctAnswer;
                }).length;
                const passed = correctCount >= 8;
                
                const record = {
                    id: Date.now(),
                    userId: AppData.currentUser.id,
                    userName: AppData.learningState.userName,
                    userDept: AppData.learningState.userDept,
                    courseId: AppData.currentCourse ? AppData.currentCourse.id : null,
                    courseTitle: AppData.currentCourse ? AppData.currentCourse.title : '„Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂Á†î‰øÆ',
                    startDate: new Date().toISOString(),
                    completedDate: new Date().toISOString(),
                    status: 'completed',
                    score: correctCount,
                    totalQuestions: totalQuestions,
                    passed: passed,
                    answers: AppData.learningState.answers
                };
                
                AppData.learningRecords.push(record);
                
                // Âç≥Â∫ß„Å´DB„Å´‰øùÂ≠ò
                await Database.save();
                
                if (AppData.currentUser) {
                    await Database.clearProgress(AppData.currentUser.id);
                }
                
                this.render();
            },

            async retakeQuiz() {
                if (AppData.currentUser) {
                    await Database.clearProgress(AppData.currentUser.id);
                }
                
                AppData.learningState = {
                    screen: 'start',
                    slideIndex: 0,
                    questionIndex: 0,
                    userName: AppData.learningState.userName,
                    userDept: AppData.learningState.userDept,
                    answers: {},
                    showExplanations: {}
                };
                this.render();
            },

            showAddLearnerModal() {
                const modal = `
                    <div class="modal active" onclick="if(event.target === this) this.remove()">
                        <div class="modal-content" onclick="event.stopPropagation()">
                            <div class="modal-header">
                                <h2>‚ûï ÂèóË¨õËÄÖ„ÇíËøΩÂä†</h2>
                                <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                            </div>
                            <div id="addLearnerError"></div>
                            <div class="form-group">
                                <label>Ê∞èÂêç <span style="color: #ef4444;">*</span></label>
                                <input type="text" id="newLearnerName" placeholder="‰æã: Áî∞‰∏≠ Â§™ÈÉé">
                            </div>
                            <div class="form-group">
                                <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span style="color: #ef4444;">*</span></label>
                                <input type="email" id="newLearnerEmail" placeholder="‰æã: tanaka@example.com">
                            </div>
                            <div class="form-group">
                                <label>ÈÉ®ÁΩ≤ <span style="color: #ef4444;">*</span></label>
                                <input type="text" id="newLearnerDept" placeholder="‰æã: „Ç§„É≥„Éô„Çπ„Éà„É°„É≥„ÉàÈÉ®">
                            </div>
                            <div class="form-group">
                                <label>„É¶„Éº„Ç∂„ÉºÂêç <span style="color: #ef4444;">*</span></label>
                                <input type="text" id="newLearnerUsername" placeholder="‰æã: tanaka">
                            </div>
                            <div class="form-group">
                                <label>„Éë„Çπ„ÉØ„Éº„Éâ <span style="color: #ef4444;">*</span></label>
                                <input type="password" id="newLearnerPassword" placeholder="8ÊñáÂ≠ó‰ª•‰∏ä">
                            </div>
                            <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                                    „Ç≠„É£„É≥„Çª„É´
                                </button>
                                <button class="btn btn-success" onclick="App.addLearner()">
                                    ËøΩÂä†
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modal);
            },

            async addLearner() {
                const name = document.getElementById('newLearnerName').value.trim();
                const email = document.getElementById('newLearnerEmail').value.trim();
                const dept = document.getElementById('newLearnerDept').value.trim();
                const username = document.getElementById('newLearnerUsername').value.trim();
                const password = document.getElementById('newLearnerPassword').value;
                
                const errorDiv = document.getElementById('addLearnerError');
                
                if (!name || !email || !dept || !username || !password) {
                    errorDiv.innerHTML = '<div class="error-message">„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                    return;
                }
                
                if (password.length < 8) {
                    errorDiv.innerHTML = '<div class="error-message">„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ8ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                    return;
                }
                
                if (AppData.users.find(u => u.username === username)) {
                    errorDiv.innerHTML = '<div class="error-message">„Åì„ÅÆ„É¶„Éº„Ç∂„ÉºÂêç„ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô</div>';
                    return;
                }
                
                if (AppData.users.find(u => u.email === email)) {
                    errorDiv.innerHTML = '<div class="error-message">„Åì„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô</div>';
                    return;
                }
                
                const maxId = Math.max(...AppData.users.map(u => u.id), 0);
                
                const newLearner = {
                    id: maxId + 1,
                    username: username,
                    password: password,
                    name: name,
                    email: email,
                    role: 'user',
                    department: dept
                };
                
                AppData.users.push(newLearner);
                
                // Âç≥Â∫ß„Å´DB„Å´‰øùÂ≠ò
                await Database.save();
                
                document.querySelector('.modal').remove();
                alert(`‚úÖ ÂèóË¨õËÄÖ„ÇíDB„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü!\n\nÊ∞èÂêç: ${name}\n„É¶„Éº„Ç∂„ÉºÂêç: ${username}`);
                
                this.render();
            },

            viewLearnerDetail(userId) {
                const learner = AppData.users.find(u => u.id === userId);
                const records = AppData.learningRecords.filter(r => r.userId === userId);
                const progress = AppData.progressData[userId];
                
                if (!learner) return;
                
                let progressHtml = '';
                if (progress) {
                    progressHtml = `
                        <div style="background: #fef3c7; padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #f59e0b;">
                            <h4 style="color: #92400e; margin-bottom: 10px;">‚è∏Ô∏è ÈÄ≤Ë°å‰∏≠</h4>
                            <p><strong>Áä∂ÊÖã:</strong> ${progress.screen === 'training' ? 'Á†î‰øÆ„Çπ„É©„Ç§„ÉâÈñ≤Ë¶ß‰∏≠' : '„ÉÜ„Çπ„ÉàÂõûÁ≠î‰∏≠'}</p>
                            ${progress.screen === 'training' ? 
                                `<p><strong>ÈÄ≤Êçó:</strong> „Çπ„É©„Ç§„Éâ ${progress.slideIndex + 1} / 19</p>` :
                                `<p><strong>ÈÄ≤Êçó:</strong> ${Object.keys(progress.answers || {}).length} / 10 ÂïèÂõûÁ≠îÊ∏à„Åø</p>`
                            }
                            <p><strong>ÊúÄÁµÇÊõ¥Êñ∞:</strong> ${new Date(progress.lastUpdated).toLocaleString('ja-JP')}</p>
                        </div>
                    `;
                }
                
                let recordsHtml = '';
                if (records.length === 0) {
                    recordsHtml = '<p style="color: #6b7280; text-align: center; padding: 20px;">ÂèóË¨õÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                } else {
                    recordsHtml = records.map((record, index) => `
                        <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">ÂèóË¨õË®òÈå≤ #${index + 1}</h4>
                            <p><strong>„Ç≥„Éº„Çπ:</strong> ${record.courseTitle}</p>
                            <p><strong>ÂÆå‰∫ÜÊó•:</strong> ${new Date(record.completedDate).toLocaleString('ja-JP')}</p>
                            <p><strong>„ÉÜ„Çπ„ÉàÁµêÊûú:</strong> <span style="color: ${record.passed ? '#10b981' : '#ef4444'}; font-weight: 600;">${record.score}ÁÇπ / ${record.totalQuestions}Âïè</span></p>
                            <p><strong>Âà§ÂÆö:</strong> ${record.passed ? '<span style="color: #10b981;">‚úÖ ÂêàÊ†º</span>' : '<span style="color: #ef4444;">‚ùå ‰∏çÂêàÊ†º</span>'}</p>
                        </div>
                    `).join('');
                }
                
                const modal = `
                    <div class="modal active" onclick="if(event.target === this) this.remove()">
                        <div class="modal-content" onclick="event.stopPropagation()">
                            <div class="modal-header">
                                <h2>üë§ ÂèóË¨õËÄÖË©≥Á¥∞</h2>
                                <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                            </div>
                            <div>
                                <h3 style="color: #1e3c72; margin-bottom: 15px;">Âü∫Êú¨ÊÉÖÂ†±</h3>
                                <p><strong>Ê∞èÂêç:</strong> ${learner.name}</p>
                                <p><strong>ÈÉ®ÁΩ≤:</strong> ${learner.department}</p>
                                <p><strong>„É°„Éº„É´:</strong> ${learner.email}</p>
                                <p><strong>„É¶„Éº„Ç∂„ÉºÂêç:</strong> ${learner.username}</p>
                            </div>
                            ${progressHtml}
                            <div>
                                <h3 style="color: #1e3c72; margin-bottom: 15px;">ÂèóË¨õÂ±•Ê≠¥</h3>
                                ${recordsHtml}
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modal);
            },

            viewCertificate(userId) {
                const learner = AppData.users.find(u => u.id === userId);
                const records = AppData.learningRecords.filter(r => r.userId === userId && r.passed);
                
                if (!learner || records.length === 0) {
                    alert('‰øÆ‰∫ÜË®º„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                const latestRecord = records[records.length - 1];
                
                const modal = `
                    <div class="modal active" onclick="if(event.target === this) this.remove()">
                        <div class="modal-content" onclick="event.stopPropagation()">
                            <div class="modal-header">
                                <h2>üìú ‰øÆ‰∫ÜË®º</h2>
                                <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                            </div>
                            <div class="certificate-container" style="margin: 0;">
                                <div class="certificate-title">üèÜ ‰øÆ‰∫ÜË®º</div>
                                <div class="certificate-body">
                                    <p style="font-size: 20px; margin-bottom: 20px;">‰ª•‰∏ã„ÅÆËÄÖ„ÅØ</p>
                                    <div class="certificate-name">${latestRecord.userName}</div>
                                    <p style="margin: 20px 0; line-height: 1.8;">
                                        „Ç§„É≥„Çµ„Ç§„ÉÄ„ÉºÂèñÂºïË¶èÂà∂„Å´„Åä„Åë„Çã<br>
                                        ÂèñÂºïÊé®Â•®Ë°åÁÇ∫„Å´Èñ¢„Åô„ÇãÁ†î‰øÆ„Çí<br>
                                        ‰øÆ‰∫Ü„Åó„Åü„Åì„Å®„ÇíË®ºÊòé„Åó„Åæ„Åô
                                    </p>
                                    <p style="margin-top: 30px; color: #6b7280;">
                                        ${new Date(latestRecord.completedDate).toLocaleDateString('ja-JP')}
                                    </p>
                                    <p style="margin-top: 10px; font-weight: 600;">
                                        ${latestRecord.userDept}
                                    </p>
                                    <p style="margin-top: 20px; color: #6b7280; font-size: 14px;">
                                        „ÉÜ„Çπ„ÉàÁµêÊûú: ${latestRecord.score}ÁÇπ / ${latestRecord.totalQuestions}Âïè
                                    </p>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <button class="btn btn-primary" onclick="window.print()">
                                    üñ®Ô∏è Âç∞Âà∑
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modal);
            },

            async saveDatabase() {
                if (await Database.save()) {
                    alert('‚úÖ „Éá„Éº„Çø„ÇíDB„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü!\n\n„É¶„Éº„Ç∂„Éº: ' + AppData.users.length + '‰ª∂\n„Ç≥„Éº„Çπ: ' + AppData.courses.length + '‰ª∂\nÂèóË¨õË®òÈå≤: ' + AppData.learningRecords.length + '‰ª∂');
                } else {
                    alert('‚ùå „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            },

            async exportDatabase() {
                const data = await Database.export();
                if (data) {
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `elearning_backup_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    alert('‚úÖ „Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü!');
                } else {
                    alert('‚ùå „Éá„Éº„Çø„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            },

            importDatabase() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = async (event) => {
                            try {
                                if (await Database.import(event.target.result)) {
                                    alert('‚úÖ „Éá„Éº„Çø„ÇíDB„Å´„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü!\n\n„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ');
                                    location.reload();
                                } else {
                                    alert('‚ùå „Éá„Éº„Çø„ÅÆ„Ç§„É≥„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                                }
                            } catch (error) {
                                alert('‚ùå „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            },

            async clearDatabase() {
                if (confirm('‚ö†Ô∏è Ë≠¶Âëä: „Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíDB„Åã„ÇâÂâäÈô§„Åó„Åæ„Åô„ÄÇ\n\nÊú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                    if (confirm('Êú¨ÂΩì„Å´„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã? „Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                        await Database.clear();
                        alert('‚úÖ „Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü\n\n„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ');
                        location.reload();
                    }
                }
            }
        };

        // „Ç¢„Éó„É™Ëµ∑Âãï
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
    </script>
</body>
</html>